    <!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="nodejh">
		<meta name="description" content="My Blog">
		<meta name="generator" content="Hugo 0.20.2" />
		<title>AJAX: XHR, jQuery and Fetch API &middot; nodejh</title>
		<link rel="shortcut icon" href="http://nodejh.com/images/favicon.ico">
		<link rel="stylesheet" href="http://nodejh.com/css/style.css">
		<link rel="stylesheet" href="http://nodejh.com/css/highlight.css">
		

		
		<link rel="stylesheet" href="http://nodejh.com/css/font-awesome.min.css">
		

		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='http://nodejh.com/'> <span class="arrow">â†</span>Home</a>
	
	<a href='http://nodejh.com/post'>Archive</a>
	<a href='http://nodejh.com/tags'>Tags</a>
	<a href='http://nodejh.com/projects'>Projects</a>
	<a href='http://nodejh.com/about'>About</a>

	

	
</nav>


        <section id="wrapper">
            <article class="post">
                <header>
                    <h1>
                        
                            åˆ†åˆ«ä½¿ç”¨ XHRã€jQuery å’Œ Fetch å®ç° AJAX
                        
                    </h1>
                    <h2 class="headline">
                    Sep 26, 2016 19:58
                    Â· 2545 words
                    Â· 6 minutes read
                      <span class="tags">
                      
                      
                          
                              <a href="http://nodejh.com/tags/javascript">JavaScript</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                  
                    <div id="toc">
                      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#ä¸€-åŸç”Ÿ-js-å®ç°-ajax">ä¸€ã€åŸç”Ÿ JS å®ç° AJAX</a>
<ul>
<li>
<ul>
<li><a href="#1-è·å–xmlhttprequestå¯¹è±¡">1. è·å–XMLHttpRequestå¯¹è±¡</a></li>
<li><a href="#2-å‘é€ä¸€ä¸ª-http-è¯·æ±‚">2. å‘é€ä¸€ä¸ª HTTP è¯·æ±‚</a></li>
<li><a href="#3-å¤„ç†æœåŠ¡å™¨çš„å“åº”">3. å¤„ç†æœåŠ¡å™¨çš„å“åº”</a></li>
</ul></li>
</ul></li>
<li><a href="#äºŒ-jquery-å®ç°-ajax">äºŒã€ jQuery å®ç° AJAX</a></li>
<li><a href="#ä¸‰-fetch-api">ä¸‰ã€Fetch API</a>
<ul>
<li>
<ul>
<li><a href="#1-ä¸€ä¸ªä½¿ç”¨-fetch-çš„ä¾‹å­">1. ä¸€ä¸ªä½¿ç”¨ Fetch çš„ä¾‹å­</a></li>
<li><a href="#2-ä½¿ç”¨-fetch-çš„æ³¨æ„äº‹é¡¹">2. ä½¿ç”¨ Fetch çš„æ³¨æ„äº‹é¡¹</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
                    </div>
                  
                
                <section id="post-body">
                    <p>æœ¬æ–‡è¯¦ç»†è®²è¿°å¦‚ä½•ä½¿ç”¨åŸç”Ÿ JSã€jQuery å’Œ Fetch æ¥å®ç° AJAXã€‚</p>

<p>AJAX å³ Asynchronous JavaScript and XMLï¼Œå¼‚æ­¥çš„ JavaScript å’Œ XMLã€‚ä½¿ç”¨ AJAX å¯ä»¥æ— åˆ·æ–°åœ°å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ¥æ”¶æœåŠ¡ç«¯å“åº”ï¼Œå¹¶æ›´æ–°é¡µé¢ã€‚</p>

<p></p>

<h2 id="ä¸€-åŸç”Ÿ-js-å®ç°-ajax">ä¸€ã€åŸç”Ÿ JS å®ç° AJAX</h2>

<p>JS å®ç° AJAX ä¸»è¦åŸºäºæµè§ˆå™¨æä¾›çš„ XMLHttpRequestï¼ˆXHRï¼‰ç±»ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ˆIE7+ã€Firefoxã€Chromeã€Safari ä»¥åŠ Operaï¼‰å‡å†…å»º XMLHttpRequest å¯¹è±¡ã€‚</p>

<p>HUGOMORE42</p>

<h4 id="1-è·å–xmlhttprequestå¯¹è±¡">1. è·å–XMLHttpRequestå¯¹è±¡</h4>

<pre><code>// è·å–XMLHttpRequestå¯¹è±¡
var xhr = new XMLHttpRequest();
</code></pre>

<p>å¦‚æœéœ€è¦å…¼å®¹è€ç‰ˆæœ¬çš„ IE (IE5, IE6) æµè§ˆå™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ ActiveX å¯¹è±¡ï¼š</p>

<pre><code>var xhr;
if (window.XMLHttpRequest) { // Mozilla, Safari...
  xhr = new XMLHttpRequest();
} else if (window.ActiveXObject) { // IE
  try {
    xhr = new ActiveXObject('Msxml2.XMLHTTP');
  } catch (e) {
    try {
      xhr = new ActiveXObject('Microsoft.XMLHTTP');
    } catch (e) {}
  }
}
</code></pre>

<h4 id="2-å‘é€ä¸€ä¸ª-http-è¯·æ±‚">2. å‘é€ä¸€ä¸ª HTTP è¯·æ±‚</h4>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€ä¸€ä¸ªURLï¼Œç„¶åå‘é€è¿™ä¸ªè¯·æ±‚ã€‚åˆ†åˆ«è¦ç”¨åˆ° XMLHttpRequest çš„ open() æ–¹æ³•å’Œ send() æ–¹æ³•ã€‚</p>

<pre><code>// GET
var xhr;
if (window.XMLHttpRequest) { // Mozilla, Safari...
  xhr = new XMLHttpRequest();
} else if (window.ActiveXObject) { // IE
  try {
    xhr = new ActiveXObject('Msxml2.XMLHTTP');
  } catch (e) {
    try {
      xhr = new ActiveXObject('Microsoft.XMLHTTP');
    } catch (e) {}
  }
}
if (xhr) {
  xhr.open('GET', '/api?username=admin&amp;password=root', true);
  xhr.send(null);
}
</code></pre>

<pre><code>// POST
var xhr;
if (window.XMLHttpRequest) { // Mozilla, Safari...
  xhr = new XMLHttpRequest();
} else if (window.ActiveXObject) { // IE
  try {
    xhr = new ActiveXObject('Msxml2.XMLHTTP');
  } catch (e) {
    try {
      xhr = new ActiveXObject('Microsoft.XMLHTTP');
    } catch (e) {}
  }
}
if (xhr) {
  xhr.open('POST', '/api', true);
  // è®¾ç½® Content-Type ä¸º application/x-www-form-urlencoded
  // ä»¥è¡¨å•çš„å½¢å¼ä¼ é€’æ•°æ®
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.send('username=admin&amp;password=root');
}
</code></pre>

<p><code>open()</code> æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p>

<ul>
<li><code>open()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ HTTP è¯·æ±‚æ–¹å¼ â€“ GETï¼ŒPOSTï¼ŒHEAD æˆ–ä»»ä½•æœåŠ¡å™¨æ‰€æ”¯æŒçš„æ‚¨æƒ³è°ƒç”¨çš„æ–¹å¼ã€‚æŒ‰ç…§HTTPè§„èŒƒï¼Œè¯¥å‚æ•°è¦å¤§å†™ï¼›å¦åˆ™ï¼ŒæŸäº›æµè§ˆå™¨(å¦‚Firefox)å¯èƒ½æ— æ³•å¤„ç†è¯·æ±‚ã€‚æœ‰å…³HTTPè¯·æ±‚æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯å¯å‚è€ƒ <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html</a></li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯·æ±‚é¡µé¢çš„ URLã€‚ç”±äºåŒæºç­–ç•¥ï¼ˆSame origin policyï¼‰è¯¥é¡µé¢ä¸èƒ½ä¸ºç¬¬ä¸‰æ–¹åŸŸåçš„é¡µé¢ã€‚åŒæ—¶ä¸€å®šè¦ä¿è¯åœ¨æ‰€æœ‰çš„é¡µé¢ä¸­éƒ½ä½¿ç”¨å‡†ç¡®çš„åŸŸåï¼Œå¦åˆ™è°ƒç”¨ <code>open()</code> ä¼šå¾—åˆ° <code>permission denied</code> çš„é”™è¯¯æç¤ºã€‚</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®è¯·æ±‚æ˜¯å¦ä¸ºå¼‚æ­¥æ¨¡å¼ã€‚å¦‚æœæ˜¯ <code>TRUE</code>ï¼ŒJavaScript å‡½æ•°å°†ç»§ç»­æ‰§è¡Œï¼Œè€Œä¸ç­‰å¾…æœåŠ¡å™¨å“åº”ã€‚è¿™å°±æ˜¯ AJAX ä¸­çš„ Aã€‚</li>
</ul>

<p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>GET</code>ï¼Œåˆ™å¯ä»¥ç›´æ¥å°†å‚æ•°æ”¾åœ¨ url åé¢ï¼Œå¦‚ï¼š<code>http://nodejh.com/api?name=admint&amp;password=root</code>ã€‚</p>

<p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>POST</code>ï¼Œåˆ™éœ€è¦å°†å‚æ•°å†™åœ¨ send() æ–¹æ³•é‡Œé¢ã€‚send() æ–¹æ³•çš„å‚æ•°å¯ä»¥æ˜¯ä»»ä½•æƒ³é€ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚è¿™æ—¶æ•°æ®è¦ä»¥å­—ç¬¦ä¸²çš„å½¢å¼é€ç»™æœåŠ¡å™¨ï¼Œå¦‚ï¼š<code>name=admint&amp;password=root</code>ã€‚æˆ–è€…ä¹Ÿå¯ä»¥ä¼ é€’ JSON æ ¼å¼çš„æ•°æ®ï¼š</p>

<pre><code>// è®¾ç½® Content-Type ä¸º application/json
xhr.setRequestHeader('Content-Type', 'application/json');
// ä¼ é€’ JSON å­—ç¬¦ä¸²
xhr.send(JSON.stringify({ username:'admin', password:'root' }));
</code></pre>

<p>å¦‚æœä¸è®¾ç½®è¯·æ±‚å¤´ï¼ŒåŸç”Ÿ AJAX ä¼šé»˜è®¤ä½¿ç”¨ Content-Type æ˜¯ <code>text/plain;charset=UTF-8</code> çš„æ–¹å¼å‘é€æ•°æ®ã€‚</p>

<p>å…³äº Content-Type æ›´è¯¦ç»†çš„å†…å®¹ï¼Œå°†åœ¨ä»¥åçš„æ–‡ç« ä¸­è§£é‡Šè¯´æ˜ã€‚</p>

<h4 id="3-å¤„ç†æœåŠ¡å™¨çš„å“åº”">3. å¤„ç†æœåŠ¡å™¨çš„å“åº”</h4>

<p>å½“å‘é€è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šå¦‚ä½•å¤„ç†æœåŠ¡å™¨çš„å“åº”ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° onreadystatechange å±æ€§æ¥æ£€æµ‹æœåŠ¡å™¨çš„å“åº”çŠ¶æ€ã€‚ä½¿ç”¨ onreadystatechange æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ç›´æ¥ onreadystatechange å±æ€§æŒ‡å®šä¸€ä¸ªå¯è°ƒç”¨çš„å‡½æ•°åï¼ŒäºŒæ˜¯ä½¿ç”¨ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼š</p>

<pre><code>// æ–¹æ³•ä¸€ æŒ‡å®šå¯è°ƒç”¨çš„å‡½æ•°
xhr.onreadystatechange = onReadyStateChange;
function onReadyStateChange() {
  // do something
}

// æ–¹æ³•äºŒ ä½¿ç”¨åŒ¿åå‡½æ•°
xhr.onreadystatechange = function(){
    // do the thing
};
</code></pre>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨å†…éƒ¨åˆ©ç”¨ readyState å±æ€§æ¥è·å–å½“å‰çš„çŠ¶æ€ï¼Œå½“ readyState çš„å€¼ä¸º 4ï¼Œå°±æ„å‘³ç€ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡å™¨å“åº”å·²ç»æ”¶åˆ°äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¤„ç†è¯¥å“åº”ï¼š</p>

<pre><code>// readyStateçš„å–å€¼å¦‚ä¸‹
// 0 (æœªåˆå§‹åŒ–)
// 1 (æ­£åœ¨è£…è½½)
// 2 (è£…è½½å®Œæ¯•)
// 3 (äº¤äº’ä¸­)
// 4 (å®Œæˆ)
if (xhr.readyState === 4) {
    // everything is good, the response is received
} else {
    // still not ready
}
</code></pre>

<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>// POST
var xhr;
if (window.XMLHttpRequest) { // Mozilla, Safari...
  xhr = new XMLHttpRequest();
} else if (window.ActiveXObject) { // IE
  try {
    xhr = new ActiveXObject('Msxml2.XMLHTTP');
  } catch (e) {
    try {
      xhr = new ActiveXObject('Microsoft.XMLHTTP');
    } catch (e) {}
  }
}
if (xhr) {
  xhr.onreadystatechange = onReadyStateChange;
  xhr.open('POST', '/api', true);
  // è®¾ç½® Content-Type ä¸º application/x-www-form-urlencoded
  // ä»¥è¡¨å•çš„å½¢å¼ä¼ é€’æ•°æ®
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.send('username=admin&amp;password=root');
}


// onreadystatechange æ–¹æ³•
function onReadyStateChange() {
  // è¯¥å‡½æ•°ä¼šè¢«è°ƒç”¨å››æ¬¡
  console.log(xhr.readyState);
  if (xhr.readyState === 4) {
    // everything is good, the response is received
    if (xhr.status === 200) {
      console.log(xhr.responseText);
    } else {
      console.log('There was a problem with the request.');
    }
  } else {
    // still not ready
    console.log('still not ready...');
  }
}
</code></pre>

<p>å½“ç„¶æˆ‘ä»¬å¯ä»¥ç”¨onloadæ¥ä»£æ›¿onreadystatechangeç­‰äº4çš„æƒ…å†µï¼Œå› ä¸ºonloadåªåœ¨çŠ¶æ€ä¸º4çš„æ—¶å€™æ‰è¢«è°ƒç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>xhr.onload = function () {    // è°ƒç”¨onload
    if (xhr.status === 200) {    // statusä¸º200è¡¨ç¤ºè¯·æ±‚æˆåŠŸ
        console.log('æ‰§è¡ŒæˆåŠŸ');
    } else {
        console.log('æ‰§è¡Œå‡ºé”™');
    }
}
</code></pre>

<p>ç„¶è€Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒIEå¯¹ onload å±æ€§çš„æ”¯æŒå¹¶ä¸å‹å¥½ã€‚é™¤äº† onload è¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ä¹Ÿå¯ä»¥ç”¨æ¥ç›‘æµ‹å“åº”çŠ¶æ€ï¼š</p>

<ul>
<li>onloadstart</li>
<li>onprogress</li>
<li>onabort</li>
<li>ontimeout</li>
<li>onerror</li>
<li>onloadend</li>
</ul>

<h2 id="äºŒ-jquery-å®ç°-ajax">äºŒã€ jQuery å®ç° AJAX</h2>

<p>jQuery ä½œä¸ºä¸€ä¸ªä½¿ç”¨äººæ•°æœ€å¤šçš„åº“ï¼Œå…¶ AJAX å¾ˆå¥½çš„å°è£…äº†åŸç”Ÿ AJAX çš„ä»£ç ï¼Œåœ¨å…¼å®¹æ€§å’Œæ˜“ç”¨æ€§æ–¹é¢éƒ½åšäº†å¾ˆå¤§çš„æé«˜ï¼Œè®© AJAX çš„è°ƒç”¨å˜å¾—éå¸¸ç®€å•ã€‚ä¸‹é¢ä¾¿æ˜¯ä¸€æ®µç®€å•çš„ jQuery çš„ AJAX ä»£ç ï¼š</p>

<pre><code>$.ajax({
  method: 'POST',
  url: '/api',
  data: { username: 'admin', password: 'root' }
})
  .done(function(msg) {
    alert( 'Data Saved: ' + msg );
  });
</code></pre>

<p>å¯¹æ¯”åŸç”Ÿ AJAX çš„å®ç°ï¼Œä½¿ç”¨ jQuery å°±å¼‚å¸¸ç®€å•äº†ã€‚å½“ç„¶æˆ‘ä»¬å¹³æ—¶ç”¨çš„æœ€å¤šçš„ï¼Œæ˜¯ä¸‹é¢ä¸¤ç§æ›´ç®€å•çš„æ–¹å¼ï¼š</p>

<pre><code>// GET
$.get('/api', function(res) {
  // do something
});

// POST
var data = {
  username: 'admin',
  password: 'root'
};
$.post('/api', data, function(res) {
  // do something
});
</code></pre>

<h2 id="ä¸‰-fetch-api">ä¸‰ã€Fetch API</h2>

<p>ä½¿ç”¨ jQuery è™½ç„¶å¯ä»¥å¤§å¤§ç®€åŒ– XMLHttpRequest çš„ä½¿ç”¨ï¼Œä½† XMLHttpRequest æœ¬è´¨ä¸Šä½†å¹¶ä¸æ˜¯ä¸€ä¸ªè®¾è®¡ä¼˜è‰¯çš„ APIï¼š
+ ä¸ç¬¦åˆå…³æ³¨åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰çš„åŸåˆ™
+ é…ç½®å’Œè°ƒç”¨æ–¹å¼éå¸¸æ··ä¹±
+ ä½¿ç”¨äº‹ä»¶æœºåˆ¶æ¥è·Ÿè¸ªçŠ¶æ€å˜åŒ–
+ åŸºäºäº‹ä»¶çš„å¼‚æ­¥æ¨¡å‹æ²¡æœ‰ç°ä»£çš„ Promiseï¼Œgenerator/yieldï¼Œasync/await å‹å¥½</p>

<p>Fetch API æ—¨åœ¨ä¿®æ­£ä¸Šè¿°ç¼ºé™·ï¼Œå®ƒæä¾›äº†ä¸ HTTP è¯­ä¹‰ç›¸åŒçš„ JS è¯­æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒå¼•å…¥äº† <code>fetch()</code> è¿™ä¸ªå®ç”¨çš„æ–¹æ³•æ¥è·å–ç½‘ç»œèµ„æºã€‚</p>

<p>Fetch çš„æµè§ˆå™¨å…¼å®¹å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="/images/ajax-js-jquery-and-fetch-api-0.png" alt="ajax-js-jquery-and-fetch-api-0.png" /></p>

<p>åŸç”Ÿæ”¯æŒç‡å¹¶ä¸é«˜ï¼Œå¹¸è¿çš„æ˜¯ï¼Œå¼•å…¥ä¸‹é¢è¿™äº› polyfill åå¯ä»¥å®Œç¾æ”¯æŒ IE8+ï¼š</p>

<ul>
<li>ç”±äº IE8 æ˜¯ ES3ï¼Œéœ€è¦å¼•å…¥ ES5 çš„ polyfill: <a href="https://github.com/es-shims/es5-shim">es5-shim, es5-sham</a></li>
<li>å¼•å…¥ Promise çš„ polyfill: <a href="https://github.com/stefanpenner/es6-promise">es6-promise</a></li>
<li>å¼•å…¥ fetch æ¢æµ‹åº“ï¼š<a href="https://github.com/camsong/fetch-detector">fetch-detector</a></li>
<li>å¼•å…¥ fetch çš„ polyfill: <a href="https://github.com/camsong/fetch-ie8">fetch-ie8</a></li>
<li>å¯é€‰ï¼šå¦‚æœä½ è¿˜ä½¿ç”¨äº† jsonpï¼Œå¼•å…¥ <a href="https://github.com/camsong/fetch-jsonp">fetch-jsonp</a></li>
<li>å¯é€‰ï¼šå¼€å¯ Babel çš„ runtime æ¨¡å¼ï¼Œç°åœ¨å°±ä½¿ç”¨ async/await</li>
</ul>

<h4 id="1-ä¸€ä¸ªä½¿ç”¨-fetch-çš„ä¾‹å­">1. ä¸€ä¸ªä½¿ç”¨ Fetch çš„ä¾‹å­</h4>

<p>å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ Fetch API çš„ä¾‹å­ ğŸŒ° ï¼š</p>

<pre><code>fetch('/api').then(function(response) {
  return response.json();
}).then(function(data) {
  console.log(data);
}).catch(function(error) {
  console.log('Oops, error: ', error);
});
</code></pre>

<p>ä½¿ç”¨ ES6 çš„ç®­å¤´å‡½æ•°åï¼š</p>

<pre><code>fetch('/api').then(response =&gt; response.json())
  .then(data =&gt; console.log(data))
  .catch(error =&gt; console.log('Oops, error: ', error))
</code></pre>

<p>å¯ä»¥çœ‹å‡ºä½¿ç”¨Fetchåæˆ‘ä»¬çš„ä»£ç æ›´åŠ ç®€æ´å’Œè¯­ä¹‰åŒ–ï¼Œé“¾å¼è°ƒç”¨çš„æ–¹å¼ä¹Ÿä½¿å…¶æ›´åŠ æµç•…å’Œæ¸…æ™°ã€‚ä½†è¿™ç§åŸºäº Promise çš„å†™æ³•è¿˜æ˜¯æœ‰ Callback çš„å½±å­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ <code>async/await</code> æ¥åšæœ€ç»ˆä¼˜åŒ–ï¼š</p>

<pre><code>async function() {
  try {
    let response = await fetch(url);
    let data = response.json();
    console.log(data);
  } catch (error) {
    console.log('Oops, error: ', error);
  }
}
</code></pre>

<p>ä½¿ç”¨ <code>await</code> åï¼Œå†™ä»£ç å°±æ›´è·ŸåŒæ­¥ä»£ç ä¸€æ ·ã€‚<code>await</code> åé¢å¯ä»¥è·Ÿ Promise å¯¹è±¡ï¼Œè¡¨ç¤ºç­‰å¾… Promise <code>resolve()</code> æ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå¦‚æœ Promise è¢« <code>reject()</code> æˆ–æŠ›å‡ºå¼‚å¸¸åˆ™ä¼šè¢«å¤–é¢çš„ <code>try...catch</code> æ•è·ã€‚</p>

<p>Promiseï¼Œgenerator/yieldï¼Œawait/async éƒ½æ˜¯ç°åœ¨å’Œæœªæ¥ JS è§£å†³å¼‚æ­¥çš„æ ‡å‡†åšæ³•ï¼Œå¯ä»¥å®Œç¾æ­é…ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ä½¿ç”¨æ ‡å‡† Promise ä¸€å¤§å¥½å¤„ã€‚</p>

<h4 id="2-ä½¿ç”¨-fetch-çš„æ³¨æ„äº‹é¡¹">2. ä½¿ç”¨ Fetch çš„æ³¨æ„äº‹é¡¹</h4>

<ul>
<li>Fetch è¯·æ±‚é»˜è®¤æ˜¯ä¸å¸¦ cookieï¼Œéœ€è¦è®¾ç½® <code>fetch(url, {credentials: 'include'})</code>`</li>
<li>æœåŠ¡å™¨è¿”å› 400ï¼Œ500 é”™è¯¯ç æ—¶å¹¶ä¸ä¼š rejectï¼Œåªæœ‰ç½‘ç»œé”™è¯¯è¿™äº›å¯¼è‡´è¯·æ±‚ä¸èƒ½å®Œæˆæ—¶ï¼Œfetch æ‰ä¼šè¢« reject</li>
</ul>

<p>æ¥ä¸‹æ¥å°†ä¸Šé¢åŸºäº XMLHttpRequest çš„ AJAX ç”¨ Fetch æ”¹å†™ï¼š</p>

<pre><code>var options = {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ username: 'admin', password: 'root' }),
    credentials: 'include'
  };

fetch('/api', options).then(response =&gt; response.json())
  .then(data =&gt; console.log(data))
  .catch(error =&gt; console.log('Oops, error: ', error))
</code></pre>

<hr />

<p>Github Issue: <a href="https://github.com/nodejh/nodejh.github.io/issues/15">https://github.com/nodejh/nodejh.github.io/issues/15</a></p>
                </section>
            </article>

            

            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'nodejh'; 

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

            

            

            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://www.facebook.com/nodejh">
        <i class="fa fa-facebook-square"></i>
    </a>
    
    <a class="symbol" href="https://www.github.com/nodejh">
        <i class="fa fa-github-square"></i>
    </a>
    
    <a class="symbol" href="https://www.twitter.com/nodejh">
        <i class="fa fa-twitter-square"></i>
    </a>
    


</div>

    
    <p class="small">
    
       Â© Copyright 2017 <i class="fa fa-heart" aria-hidden="true"></i> nodejh
    
    </p>
    <p class="small">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/nodejh/hugo-theme-cactus-plus">nodejh</a>
    </p>
</footer>

        </section>

        <script src="http://nodejh.com/js/jquery-2.2.4.min.js"></script>
<script src="http://nodejh.com/js/main.js"></script>
<script src="http://nodejh.com/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-84989670-1', 'auto');
ga('send', 'pageview');
</script>




<script>
var baiduAnalytics = '39843ea392201290bd6f76173d2e1633';
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?" + baiduAnalytics;
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


    </body>
</html>
