<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <title>在 MacOS Sierra 上安装 Apache 和多个版本的 PHP | Hang Jiang</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="前言：每次搭建开发环境真的是一件很麻烦的事情，但随着时间的推移和系统环境的差异，网上的教程自己曾经安装的经验经常不合时宜，总会出现一些这样或">
<meta name="generator" content="Hugo 0.82.0" />


  <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-84989670-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>首页</a>
	
	<a href="/posts">归档</a>
	<a href="/tags">标签</a>
	<a href="/about">关于</a>

	

	
	  <a class="button" href="https://nodejh.com/index.xml">订阅</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">在 MacOS Sierra 上安装 Apache 和多个版本的 PHP</h1>

    <div class="tip">
        <time datetime="2016-12-29 00:04:41 &#43;0800 CST">2016年12月29日</time>
        <span class="split">
          ·
        </span>
        <span>
          5637字
        </span>
        <span class="split">
          ·
        </span>
        <span>
          12分钟
        </span>
    </div>

    
    


    <div class="content">
      <p>前言：每次搭建开发环境真的是一件很麻烦的事情，但随着时间的推移和系统环境的差异，网上的教程自己曾经安装的经验经常不合时宜，总会出现一些这样或那样的问题。</p>
<p>通过几番搜寻，我终于找到一篇完善的教程，将其翻译成了中文。我也会持续更新这篇文章，不断完善并记录遇到的或新或旧的问题。希望这篇文章可以终结在 macOS 上安装 PHP 开发环境的话题。</p>
<blockquote>
<p>本文主要内容翻译自<a href="https://getgrav.org/blog/macos-sierra-apache-multiple-php-versions" target="_blank" rel="noopener">《macOS 10.12 Sierra Apache Setup: Multiple PHP Versions》</a>，并加入了自己的实践。</p>
</blockquote>
<p>关于如何在 macOS 10.12 上搭建 Web 开发环境，原作者一共写了三篇文章。这是第一篇。</p>
<p>当前的操作系统是 macOS 10.12，这篇教程讲述的环境搭建和一般 PHP 安装最大的不同是，我们不使用系统自带的 Apache（macOS 自带了 apache、python、ruby 等一些列开发工具），而是使用 Homebrew 的 Apache。当然，系统自带的 Apaceh 也是可以工作的。</p>
<p>在 macOs 上进行 Web 开发，确实是一件很令人愉快的事情。目前也有很多集成开发工具可以方便地搭建开发环境，比如 <a href="http://www.mamp.info/en/mamp-pro/" target="_blank" rel="noopener">MAMP PRO</a>，它具有非常漂亮的一个 UI 界面，并且集成了 Apache、PHP 和 MySQL 三个软件，非常适合新手使用。但是有时候，由于其配置模板有限，软件没有及时升级，使用它的时候可能会遇到软件版本不能及时更新、配置不够方便灵活等问题。</p>
<p>于是很多人就开始寻找替代方案。幸运的是，这篇文章就是一个替代方案。并且文章给出了简单直接的安装配置步骤。</p>
<h2 id="1-安装-homebrew">1. 安装 Homebrew <a href="#1-%e5%ae%89%e8%a3%85-homebrew" class="anchor">🔗</a></h2><p>以下所有软件的安装都依赖于 macOS 上的一个包管理工具 Homebrew。使用 <code>brew</code> 命令，我们可以方便地在 mac 上安装各种功能各异的软件，当然，首先的安装 homebrew。安装步骤也非常简单，打开终端然后输入下面的代码：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ruby -e <span style="color:#b44">&#34;</span><span style="color:#a2f;font-weight:bold">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span style="color:#a2f;font-weight:bold">)</span><span style="color:#b44">&#34;</span>
</code></pre></div><p>然后等待终端提示你输入密码，程序就会开始自动安装。如果你没有安装 <code>XCode Command Line Tools</code>，它会自动帮你装上。等待几分钟，待完成后，就可以使用下面的命令查看 Homebrew 是否正确安装：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew --version
Homebrew 1.1.5
Homebrew/homebrew-core <span style="color:#666">(</span>git revision a50a6; last commit 2016-12-28<span style="color:#666">)</span>
</code></pre></div><p>同时可能你也需要执行一下下面的命令，来检测配置是否正确：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew doctor
</code></pre></div><p>若有配置不当的地方，brew 会给出提示，安装提示修复即可。</p>
<h3 id="11-添加第三方仓库">1.1 添加第三方仓库 <a href="#11-%e6%b7%bb%e5%8a%a0%e7%ac%ac%e4%b8%89%e6%96%b9%e4%bb%93%e5%ba%93" class="anchor">🔗</a></h3><p>我们将需要使用一些来自第三方仓库的软件，所以需要添加额外的仓库：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew tap homebrew/php
$ brew tap homebrew/apache
</code></pre></div><p>然后更新 brew：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew update
</code></pre></div><p>接下来就可以尽情使用 brew 了。</p>
<h2 id="2-apache-的安装">2. Apache 的安装 <a href="#2-apache-%e7%9a%84%e5%ae%89%e8%a3%85" class="anchor">🔗</a></h2><p>最新的 macOS 10.12 预装了 Apache 2.4，但苹果移除了一些必要的脚本，所以 Apache 和 Homebrew 配合使用将会变得困难。当然解决该问题的方法就是，使用 Homebrew 重新安装配置 Apache，并使其运行在标准端口上（80/443）。</p>
<p>如果之前已经安装有 Apache 并且在运行中，首先就需要关闭它，然后移除自动加载脚本。下面的命令没有任何副作用，只管运行就好了：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apachectl stop
$ sudo launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist 2&gt;/dev/null
$ brew install httpd24 --with-privileged-ports --with-http2
</code></pre></div><p>接下来需要等待一小会儿，因为这个命令是下载源码并编译安装 Apache。上面命令执行结果如下面这样：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">🍺  /usr/local/Cellar/httpd24/2.4.23_2: <span style="color:#666">212</span> files, 4.4M, built in <span style="color:#666">1</span> minute <span style="color:#666">45</span> seconds
</code></pre></div><p>这里的路径很重要，因为在接下来的步骤中，我们都需要使用这个路径，在这个例子中，路径是 <code>/usr/local/Cellar/httpd24/2.4.23_2/</code>，如果你的路径不是这个，则在运行下面的命令的时候，将其替换为你的路径就可以了：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo cp -v /usr/local/Cellar/httpd24/2.4.23_2/homebrew.mxcl.httpd24.plist /Library/LaunchDaemons
$ sudo chown -v root:wheel /Library/LaunchDaemons/homebrew.mxcl.httpd24.plist
$ sudo chmod -v <span style="color:#666">644</span> /Library/LaunchDaemons/homebrew.mxcl.httpd24.plist
$ sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.httpd24.plist
</code></pre></div><p>现在我们就通过 Homebrew 安装上了 Apache，并使用管理员权限将其配置为自动启动。这个时候 Apache 应该已经在运行了，所以你打开浏览器访问 <code>localhost</code> 将会看到 “It works！”。</p>
<p><p class="markdown-image">
  <img src="./images/macOS-Sierra-Apache-Multiple-PHP-versions-php-information-page-it-works.png" alt="macOS-Sierra-Apache-Multiple-PHP-versions-php-information-page-it-works"  />
</p></p>
<h3 id="21-一些小问题">2.1 一些小问题 <a href="#21-%e4%b8%80%e4%ba%9b%e5%b0%8f%e9%97%ae%e9%a2%98" class="anchor">🔗</a></h3><p>如果你的浏览器提示说不能建立连接到服务器，那么首先检查一下 Apache 服务是否已经启动了：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ps -aef | grep httpd
</code></pre></div><p>如果 Apache 正在运行，你将会看到一些 httpd 进程。</p>
<p>重启 Apache：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apachectl -k restart
</code></pre></div><p>我们也可以监控 Apache 的错误日志，查看是否有错误信息：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ tail -f /usr/local/var/log/apache2/error_log
</code></pre></div><p>如果上面这些步骤都没有解决问题，那么确定你的 Apache 是否监听了 <code>80</code> 端口，即 <code>/usr/local/etc/apache2/2.4/httpd.conf</code> 配置文件是否有 <code>Listen: 80</code>，或者 <code>Listen:</code> 后面是其他端口。</p>
<p>Apache 是通过 <code>apachectl</code> 来进行控制的，它的基本使用方法如下：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apachectl start
$ sudo apachectl stop
$ sudo apachectl -k restart
</code></pre></div><p><code>-k</code> 参数将强制重启 Apache，不管 Apache 是否准备好。</p>
<p>最终我将我的 Apache 的端口修改为了 <code>7070</code>，主要是因为 <code>80</code> 端口是 HTTP 服务的默认端口，<code>8080</code> 端口是 Tomcat 的默认端口，为了避免与其他软件如 nginx 等发生潜在端口冲突问题，所以改为了 <code>7070</code>。</p>
<h3 id="22-apache-的配置">2.2 Apache 的配置 <a href="#22-apache-%e7%9a%84%e9%85%8d%e7%bd%ae" class="anchor">🔗</a></h3><p>现在我们已经有了一个 Web 服务器，接下来我们需要对其进行一些配置，以便于更方便我们本地的开发。</p>
<p>首先修改 Apache 的 <code>document root</code>，这是 Web 服务的根目录，Apache 会从这个目录中寻找资源文件。默认的 document root 是 <code>/Library/WebServer/Documents</code>。作为一个开发环境，我们可能更希望网站的根目录（即 Web 服务的根目录）在我们自己的用户主目录下。所以接下来修改配置。</p>
<p>我们可以在终端通过 <code>open -e</code> 命令使用 Mac 默认的文本编辑器打开一个文件：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ open -e /usr/local/etc/apache2/2.4/httpd.conf
</code></pre></div><p><p class="markdown-image">
  <img src="./images/macOS-Sierra-Apache-Multiple-PHP-versions-php-information-page-it-works-textedit.png" alt="macOS-Sierra-Apache-Multiple-PHP-versions-php-information-page-it-works-textedit"  />
</p></p>
<p>搜索 <code>DocumentRoot</code>，然后你会看到下面这行：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">DocumentRoot &#34;/usr/local/var/www/htdocs&#34;
</code></pre></div><p>将这行配置改为自己的用户主目录中的目录，把 <code>your_user</code> 改为你的用户名：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">DocumentRoot &#34;/Users/your_user/sites&#34;
</code></pre></div><p>紧接着还要将上面这行代码下面的 <code>&lt;Directory&gt;</code> 也改为你的新的 document root：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#008000;font-weight:bold">&lt;Directory</span> <span style="">&#34;/Users/your_user/sites&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>
</code></pre></div><p>在 <code>&lt;Directory&gt;</code> 代码块里面，我们还需要将 <code>AllowOverride</code> 改为下面的样子：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#080;font-style:italic"># AllowOverride controls what directives may be placed in .htaccess files.</span>
<span style="color:#080;font-style:italic"># It can be &#34;All&#34;, &#34;None&#34;, or any combination of the keywords:</span>
<span style="color:#080;font-style:italic">#   AllowOverride FileInfo AuthConfig Limit</span>
<span style="color:#080;font-style:italic">#</span>
AllowOverride All
</code></pre></div><p>接下来通过取消注释使用 <code>mod_rewrite</code> 模块：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">LoadModule rewrite_module libexec/mod_rewrite.so
</code></pre></div><h3 id="24-用户和用户组">2.4 用户和用户组 <a href="#24-%e7%94%a8%e6%88%b7%e5%92%8c%e7%94%a8%e6%88%b7%e7%bb%84" class="anchor">🔗</a></h3><p>现在 Apache 已经指向了我们的用户主目录下的 sites 目录，不过依旧还存在一个问题。Apche 运行的时候，其用户及用户组都是 <code>daemon</code>，当程序访问我们的用户主目录的时候，就会遇到权限问题。解决这个问题的方法就是，在 <code>httpd.conf</code> 将用户和用户组分别改为你的用户名 <code>your_user</code> 和 <code>staff</code>：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">User your_user
Group staff
</code></pre></div><h3 id="25-sites-目录">2.5 sites 目录 <a href="#25-sites-%e7%9b%ae%e5%bd%95" class="anchor">🔗</a></h3><p>接下来就需要在用户主目录下创建一个 <code>sites</code> 目录了，然后添加一个简单的 <code>index.html</code> 文件，并写入 <code>&lt;h1&gt;My User Web Root&lt;/h1&gt;</code> 代码：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir ~/Sites
$ <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;&lt;h1&gt;My User Web Root&lt;/h1&gt;&#34;</span> &gt; ~/sites/index.html
</code></pre></div><p>注意，<code>sites</code> 目录的绝对路径需要和 <code>httpd.conf</code> 中的 <code>DocumentRoot</code> 保持一致。</p>
<p>然后重启 Apache 使配置生效：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apachectl -k restart
</code></pre></div><p>再访问 <code>http://localhost</code> 就会显示 <code>index.html</code> 里面的内容。如果你的配置也生效了，我们就可以继续下一步了。</p>
<p><p class="markdown-image">
  <img src="./images/macOS-Sierra-Apache-Multiple-PHP-versions-php-sites-webroot.png" alt="macOS-Sierra-Apache-Multiple-PHP-versions-php-sites-webroot"  />
</p></p>
<h2 id="3-php-的安装">3. PHP 的安装 <a href="#3-php-%e7%9a%84%e5%ae%89%e8%a3%85" class="anchor">🔗</a></h2><p>我们接下来安装 PHP 5.5、PHP 5.6、PHP 7.0 和 PHP 7.1，并使用一个简单的脚本来切换不同的版本。</p>
<p>你可以使用 <code>brew options php55</code> 来查看所有可以安装的选项设置，比如在这个例子中，我们使用 <code>--with-httpd24</code> 参数来编译安装 PHP 以及使 Apache 支持 PHP 所需要的一些模块。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew install php55 --with-httpd24
$ brew unlink php55
$ brew install php56 --with-httpd24
$ brew unlink php56
$ brew install php70 --with-httpd24
$ brew unlink php70
$ brew install php71 --with-httpd24
</code></pre></div><p>上面的命令会从源码下载 PHP，并进行编译安装。这可能需要一点时间。</p>
<p>如果之前已经安装过 PHP，可能需要使用 <code>reinstall</code> 来代替 <code>install</code> 进行安装。</p>
<h4 id="301-issue-configure-error-cannot-find-libz">3.0.1 ISSUE configure: error: Cannot find libz <a href="#301-issue-configure-error-cannot-find-libz" class="anchor">🔗</a></h4><p>我在安装的时候遇到了一个错误：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">==&gt; ./configure --prefix=/usr/local/Cellar/php56/5.6.11_2 --localstatedir=/usr/local/var --sysconfdir=/usr/local/etc/php/5.6 --with-config-file-path=/usr/local/etc/php/5.6 --with
checking whether to enable the SQLite3 extension... yes
checking bundled sqlite3 library... yes
checking for ZLIB support... yes
checking if the location of ZLIB install directory is defined... no
configure: error: Cannot find libz
</code></pre></div><p>最终在 Github 上找到了该 ISSUE <a href="https://github.com/Homebrew/homebrew-php/issues/1946" target="_blank" rel="noopener">Cannot find libz when install php56 #1946
</a>。</p>
<p>其原因可能是 Xcode 的 Command Line Tool 没有正确安装。解决问题的方法是运行下面的命令来重新安装：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ xcode-select --install
</code></pre></div><p>可能你也需要根据自己的需要修改一些 PHP 的配置，常见的比如修改内存配置或 <code>date.timezone</code> 配置。各个版本的配置文件即 <code>php.ini</code> 在下面的目录：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/usr/local/etc/php/5.5/php.ini
/usr/local/etc/php/5.6/php.ini
/usr/local/etc/php/7.0/php.ini
/usr/local/etc/php/7.1/php.ini
</code></pre></div><h3 id="31-apache-和-php-的配置---第一部分">3.1. Apache 和 PHP 的配置 - 第一部分 <a href="#31-apache-%e5%92%8c-php-%e7%9a%84%e9%85%8d%e7%bd%ae---%e7%ac%ac%e4%b8%80%e9%83%a8%e5%88%86" class="anchor">🔗</a></h3><p>我们已经成功安装了多个版本的 PHP，但我们还需要告诉 Apache 怎么使用它们。再次打开 <code>/usr/local/etc/apache2/2.4/httpd.conf</code>，并搜索 <code>LoadModule php5_module</code> 所在行。</p>
<p>可以发现，每个版本的 PHP 都有一个 <code>LoadModule</code> 入口，每个 <code>LoadModule</code> 都指向一个特定版本的 PHP。这里默认的路径如 <code>/usr/local/Cellar/php71/7.1.0_11/libexec/apache2/libphp7.so</code> 是 <code>brew</code> 应用程序的安装路径，我们可以使用一个更通用的路径来替换它们（具体的路径可能有所不同）：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">LoadModule php5_module        /usr/local/Cellar/php55/5.5.38_11/libexec/apache2/libphp5.so
LoadModule php5_module        /usr/local/Cellar/php56/5.6.29_5/libexec/apache2/libphp5.so
LoadModule php7_module        /usr/local/Cellar/php70/7.0.14_7/libexec/apache2/libphp7.so
LoadModule php7_module        /usr/local/Cellar/php71/7.1.0_11/libexec/apache2/libphp7.so
</code></pre></div><p>将上面的路径修改为：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">LoadModule php5_module        /usr/local/opt/php55/libexec/apache2/libphp5.so
LoadModule php5_module        /usr/local/opt/php56/libexec/apache2/libphp5.so
LoadModule php7_module        /usr/local/opt/php70/libexec/apache2/libphp7.so
LoadModule php7_module        /usr/local/opt/php71/libexec/apache2/libphp7.so
</code></pre></div><p>之所以可以这么修改，是因为 <code>/usr/local/opt/php71</code> 其实是由 <code>brew</code> 创建的 <code>/usr/local/Cellar/php71</code> 的一个软连接。</p>
<p>这么修改的好处是，升级 PHP 的小版本号的时候，比如由 <code>7.1.0_11</code> 时，我们就不需要再修改 <code>LoadModule</code> 对应的值了。</p>
<p>我们每次开发或运行依旧只需要一般也只能使用某一个版本的 PHP。以我们要使用 7.1 这个版本开发应用为例，将其他版本的 <code>LoadModule</code> 都注释掉，只保留对应版本的 <code>LoadModule</code>：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#080;font-style:italic">#LoadModule php5_module        /usr/local/opt/php55/libexec/apache2/libphp5.so</span>
<span style="color:#080;font-style:italic">#LoadModule php5_module        /usr/local/opt/php56/libexec/apache2/libphp5.so</span>
<span style="color:#080;font-style:italic">#LoadModule php7_module        /usr/local/opt/php70/libexec/apache2/libphp7.so</span>
LoadModule php7_module        /usr/local/opt/php71/libexec/apache2/libphp7.so
</code></pre></div><p>这样的配置就会告诉 Apache 使用 PHP 7.1 来处理 PHP 请求。（稍后我们将添加切换 PHP 版本的脚本。）</p>
<p>接下来还需要配置 PHP 的主目录索引文件（Directory Indexes），找到下面的代码块：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#008000;font-weight:bold">&lt;IfModule</span> <span style="">dir_module</span><span style="color:#008000;font-weight:bold">&gt;</span>
    DirectoryIndex index.html
<span style="color:#008000;font-weight:bold">&lt;/IfModule&gt;</span>
</code></pre></div><p>将其替换为下面的代码：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#008000;font-weight:bold">&lt;IfModule</span> <span style="">dir_module</span><span style="color:#008000;font-weight:bold">&gt;</span>
    DirectoryIndex index.php index.html
<span style="color:#008000;font-weight:bold">&lt;/IfModule&gt;</span>

<span style="color:#008000;font-weight:bold">&lt;FilesMatch</span> <span style="">\.php$</span><span style="color:#008000;font-weight:bold">&gt;</span>
    SetHandler application/x-httpd-php
<span style="color:#008000;font-weight:bold">&lt;/FilesMatch&gt;</span>
</code></pre></div><p>保存后重启 Apache，PHP 的安装就完成了：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apachectl -k restart
</code></pre></div><h3 id="32-验证-php-安装结果">3.2. 验证 PHP 安装结果 <a href="#32-%e9%aa%8c%e8%af%81-php-%e5%ae%89%e8%a3%85%e7%bb%93%e6%9e%9c" class="anchor">🔗</a></h3><p>验证 PHP 是否正确安装的最好方法是使用 <code>phpinfo()</code> 这个函数，这个函数会输出 PHP 的版本等信息。当然，最好不要在你的生产环境中使用它。但在开发环境中，使用它对我们了解系统中 PHP 安装信息非常有帮助。</p>
<p>在网站主目录即你的 <code>sites/</code> 目录下创建一个 <code>info.php</code> 的文件，然后输入下面的代码：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#666">&lt;?</span>php
phpinfo();
<span style="color:#080">?&gt;</span><span style="">
</span></code></pre></div><p>打开浏览器，访问 <code>http://localhost:7070/info.php</code>，你讲看到下面的完美的 PHP 信息页面：</p>
<p><p class="markdown-image">
  <img src="./images/macOS-Sierra-Apache-Multiple-PHP-versions-php-information-page.png" alt="php information page"  />
</p></p>
<p>如果能够看到类似的页面，就说明 Apache 和 PHP 已经成功运行了。你可以通过注释 <code>LoadModule ... php56 ...</code> 来测试其他版本的 PHP。修改配置后，重启 Apache 并刷新页面就能看到类似的页面了。</p>
<h3 id="33-php-版本切换脚本">3.3 PHP 版本切换脚本 <a href="#33-php-%e7%89%88%e6%9c%ac%e5%88%87%e6%8d%a2%e8%84%9a%e6%9c%ac" class="anchor">🔗</a></h3><p>在开发中，如果每次都通过修改 <code>/usr/local/etc/apache2/2.4/httpd.conf</code> 文件去切换 PHP 版本，显然太麻烦了。有没有更容易的方法呢？幸运的是，一些勤劳的开发者已经写好了这样的一个脚本 <a href="https://gist.github.com/w00fz/142b6b19750ea6979137b963df959d11" target="_blank" rel="noopener"> PHP switcher script</a>。</p>
<p>接下来我们将添加 sphp 到 brew 的 /usr/local/bin 里面。原文给的方法是使用下面的命令：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -L https://gist.github.com/w00fz/142b6b19750ea6979137b963df959d11/raw &gt; /usr/local/bin/sphp
$ chmod +x /usr/local/bin/sphp
</code></pre></div><p>其中第一行命令的作用，就是将 Gist 上的这个切换 PHP 版本的脚本下载并写入到 <code>/usr/local/bin/sphp</code> 这个文件里面。第二行命令的作用是赋予 <code>/usr/local/bin/sphp</code> 可执行权限。</p>
<p>但由于国内并不能访问 Gist，所以第一行命令并不能执行成功。所以我在这里提供了整个脚本代码：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#080">#!/bin/bash
</span><span style="color:#080"></span>
<span style="color:#080;font-style:italic"># Check if command was ran as root.</span>
<span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">[[</span> <span style="color:#a2f;font-weight:bold">$(</span>id -u<span style="color:#a2f;font-weight:bold">)</span> -eq <span style="color:#666">0</span> <span style="color:#666">]]</span>; <span style="color:#a2f;font-weight:bold">then</span>
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;The command \&#34;sphp\&#34; should not be executed as root or via sudo directly.&#34;</span>
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;When a service requires root access, you will be prompted for a password as needed.&#34;</span>
    <span style="color:#a2f">exit</span> <span style="color:#666">1</span>
<span style="color:#a2f;font-weight:bold">fi</span>

<span style="color:#080;font-style:italic"># Usage</span>
<span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#b8860b">$#</span> -ne <span style="color:#666">1</span> <span style="color:#666">]</span>; <span style="color:#a2f;font-weight:bold">then</span>
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Usage: sphp [phpversion]&#34;</span>
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Versions installed:&#34;</span>
    brew list | grep <span style="color:#b44">&#39;^php[0-9]\{2,\}$&#39;</span> | grep -o -E <span style="color:#b44">&#39;[0-9]+&#39;</span> | <span style="color:#a2f;font-weight:bold">while</span> <span style="color:#a2f">read</span> -r line ; <span style="color:#a2f;font-weight:bold">do</span>
        <span style="color:#a2f">echo</span> <span style="color:#b44">&#34; - phpversion: </span><span style="color:#b8860b">$line</span><span style="color:#b44">&#34;</span>
    <span style="color:#a2f;font-weight:bold">done</span>
    <span style="color:#a2f">exit</span> <span style="color:#666">1</span>
<span style="color:#a2f;font-weight:bold">fi</span>

<span style="color:#b8860b">currentversion</span><span style="color:#666">=</span><span style="color:#b44">&#34;`php -r \&#34;error_reporting(0); echo str_replace(&#39;.&#39;, &#39;&#39;, substr(phpversion(), 0, 3));\&#34;`&#34;</span>
<span style="color:#b8860b">newversion</span><span style="color:#666">=</span><span style="color:#b44">&#34;</span><span style="color:#b8860b">$1</span><span style="color:#b44">&#34;</span>

<span style="color:#b8860b">majorOld</span><span style="color:#666">=</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">currentversion</span>:<span style="color:#b8860b">0</span>:<span style="color:#b8860b">1</span><span style="color:#b68;font-weight:bold">}</span>
<span style="color:#b8860b">majorNew</span><span style="color:#666">=</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">newversion</span>:<span style="color:#b8860b">0</span>:<span style="color:#b8860b">1</span><span style="color:#b68;font-weight:bold">}</span>
<span style="color:#b8860b">minorNew</span><span style="color:#666">=</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">newversion</span>:<span style="color:#b8860b">1</span>:<span style="color:#b8860b">1</span><span style="color:#b68;font-weight:bold">}</span>

brew list php<span style="color:#b8860b">$newversion</span> 2&gt; /dev/null &gt; /dev/null

<span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#b8860b">$?</span> -eq <span style="color:#666">0</span> <span style="color:#666">]</span>; <span style="color:#a2f;font-weight:bold">then</span>
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;PHP version </span><span style="color:#b8860b">$newversion</span><span style="color:#b44"> found&#34;</span>

    <span style="color:#080;font-style:italic"># Check if new version is already the current version.</span>
    <span style="color:#080;font-style:italic"># if [ &#34;${newversion}&#34; == &#34;${currentversion}&#34; ]; then</span>
    <span style="color:#080;font-style:italic">#     echo -n &#34;PHP version ${newversion} is already being used. Continue by reloading? (y/n) &#34;</span>
    <span style="color:#080;font-style:italic">#     while true; do</span>
    <span style="color:#080;font-style:italic">#         read -n 1 yn</span>
    <span style="color:#080;font-style:italic">#         case $yn in</span>
    <span style="color:#080;font-style:italic">#             [Yy]* ) echo &amp;&amp; break;;</span>
    <span style="color:#080;font-style:italic">#             [Nn]* ) echo &amp;&amp; exit 1;;</span>
    <span style="color:#080;font-style:italic">#         esac</span>
    <span style="color:#080;font-style:italic">#     done</span>
    <span style="color:#080;font-style:italic"># fi</span>

    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Unlinking old binaries...&#34;</span>
    brew unlink php<span style="color:#b8860b">$currentversion</span> 2&gt; /dev/null &gt; /dev/null

    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Linking new binaries...&#34;</span>
    brew link php<span style="color:#b8860b">$newversion</span>

    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Linking new modphp addon...&#34;</span>
    sudo ln -sf <span style="color:#b44">`</span>brew list php<span style="color:#b8860b">$newversion</span> | grep libphp<span style="color:#b44">`</span> /usr/local/lib/libphp<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">majorNew</span><span style="color:#b68;font-weight:bold">}</span>.so
    <span style="color:#a2f">echo</span> /usr/local/lib/libphp<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">majorNew</span><span style="color:#b68;font-weight:bold">}</span>.so
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Fixing LoadModule...&#34;</span>
    <span style="color:#b8860b">apacheConf</span><span style="color:#666">=</span><span style="color:#b44">`</span>httpd -V | grep -i server_config_file | cut -d <span style="color:#b44">&#39;&#34;&#39;</span> -f 2<span style="color:#b44">`</span>
    sudo sed -i -e <span style="color:#b44">&#34;/LoadModule php</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">majorOld</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">_module/s/^#*/#/&#34;</span> <span style="color:#b8860b">$apacheConf</span>

    <span style="color:#a2f;font-weight:bold">if</span> grep <span style="color:#b44">&#34;LoadModule php</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">majorNew</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">_module .*php</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">newversion</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span> <span style="color:#b8860b">$apacheConf</span> &gt; /dev/null
    <span style="color:#a2f;font-weight:bold">then</span>
        sudo sed -i -e <span style="color:#b44">&#34;/LoadModule php</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">majorNew</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">_module .*php</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">newversion</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">/s/^#//&#34;</span> <span style="color:#b8860b">$apacheConf</span>
    <span style="color:#a2f;font-weight:bold">else</span>
        sudo sed -i -e <span style="color:#b44">&#34;/LoadModule php</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">majorNew</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">_module/s/^#//&#34;</span> <span style="color:#b8860b">$apacheConf</span>
    <span style="color:#a2f;font-weight:bold">fi</span>

    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Updating version file...&#34;</span>

    pgrep -f /usr/sbin/httpd 2&gt; /dev/null &gt; /dev/null
    <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#b8860b">$?</span> -eq <span style="color:#666">0</span> <span style="color:#666">]</span>; <span style="color:#a2f;font-weight:bold">then</span>
        <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Restarting system Apache...&#34;</span>
        sudo pkill -9 -f /usr/sbin/httpd
        sudo /usr/sbin/apachectl -k restart &gt; /dev/null 2&gt;&amp;<span style="color:#666">1</span>
    <span style="color:#a2f;font-weight:bold">fi</span>

    pgrep -f /usr/local/<span style="color:#b44">&#34;Cellar|opt&#34;</span>/*/httpd 2&gt; /dev/null &gt; /dev/null
    <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#b8860b">$?</span> -eq <span style="color:#666">0</span> <span style="color:#666">]</span>; <span style="color:#a2f;font-weight:bold">then</span>
        <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Restarting homebrew Apache...&#34;</span>
        sudo pkill -9 -f /usr/local/<span style="color:#b44">&#34;Cellar|opt&#34;</span>/*/httpd
        sudo /usr/local/bin/apachectl -k restart &gt; /dev/null 2&gt;&amp;<span style="color:#666">1</span>
    <span style="color:#a2f;font-weight:bold">fi</span>

    <span style="color:#080;font-style:italic"># pgrep -x httpd 2&gt; /dev/null &gt; /dev/null</span>
    <span style="color:#080;font-style:italic"># if [ $? -eq 0 ]; then</span>
    <span style="color:#080;font-style:italic">#     echo &#34;Restarting non-root homebrew Apache...&#34;</span>
    <span style="color:#080;font-style:italic">#     httpd -k restart &gt; /dev/null 2&gt;&amp;1</span>
    <span style="color:#080;font-style:italic"># fi</span>

    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Done.&#34;</span>

    <span style="color:#080;font-style:italic"># Show PHP CLI version for verification.</span>
    <span style="color:#a2f">echo</span> <span style="color:#666">&amp;&amp;</span> php -v
<span style="color:#a2f;font-weight:bold">else</span>
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;PHP version </span><span style="color:#b8860b">$majorNew</span><span style="color:#b44">.</span><span style="color:#b8860b">$minorNew</span><span style="color:#b44"> was not found.&#34;</span>
    <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;Try \`brew install php</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">newversion</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">\` first.&#34;</span>
    <span style="color:#a2f">exit</span> <span style="color:#666">1</span>
<span style="color:#a2f;font-weight:bold">fi</span>
</code></pre></div><p>首先在 <code>/usr/local/bin/</code> 目录下新建 <code>sphp</code> 文件，然后通过 <code>open</code> 命令使用默认的编辑器打开它：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ touch /usr/local/bin/sphp
$ open -e /usr/local/bin/sphp
</code></pre></div><p>将上面的代码复制进去并保存，然后赋予可执行权限：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ chmod +x /usr/local/bin/sphp
</code></pre></div><h3 id="34-检测-path-路径">3.4. 检测 PATH 路径 <a href="#34-%e6%a3%80%e6%b5%8b-path-%e8%b7%af%e5%be%84" class="anchor">🔗</a></h3><p>Homebrew 在安装程序的时候一般会把程序的可执行文件加入到 <code>/usr/local/bin</code> 和 <code>/usr/local/sbin</code> 这两个目录里面。通过下面的命令可以快速测试可执行文件路径是否正确：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ echo $PATH
/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
</code></pre></div><p>如果没有看到类似的输出，你可能需要手动添加这些路径。添加下面的代码到 shell 的配置文件中（不同的 shell 可能需要将路径添加到不同的配置文件中，如 <code>~/.profile</code> <code>~/.bash_profile</code> <code>~/.zshrc</code>）。如果使用的是 macOS 默认的 shell，则添加到 <code>~/.profile</code> （若没有这个文件，则创建它）；如果使用的是 zsh，则添加到 <code>~/.zshrc</code>：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">export PATH=/usr/local/bin:/usr/local/sbin:$PATH
</code></pre></div><p>在添加路径到配置文件的时候，最好关闭其他不相关的终端，因为某些开着的终端可能会对路径造成一些奇怪的问题。添加完成后，配置会在下次打开终端的时候生效。或者使用下面的命令，重新载入配置文件使其立即生效：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># 若使用的是默认终端
$ source ~/.profile
# 或如果使用的是 zsh
$ source ~/.zshrc
</code></pre></div><h3 id="35-apache-和-php-的配置---第二部分">3.5. Apache 和 PHP 的配置 - 第二部分 <a href="#35-apache-%e5%92%8c-php-%e7%9a%84%e9%85%8d%e7%bd%ae---%e7%ac%ac%e4%ba%8c%e9%83%a8%e5%88%86" class="anchor">🔗</a></h3><p>尽管之前我们已经配置好了 Apache 和 PHP，现在我们还需要修改配置文件，来使用 <code>PHP switcher script</code> 切换 PHP 的版本。继续打开 <code>/usr/local/etc/apache2/2.4/httpd.conf</code> 然后找到 <code>LoadModule php</code> 所在的行：</p>
<p>然后注释掉正在使用的 <code>LoadModule</code>：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">#LoadModule php5_module        /usr/local/opt/php55/libexec/apache2/libphp5.so
#LoadModule php5_module        /usr/local/opt/php56/libexec/apache2/libphp5.so
#LoadModule php7_module        /usr/local/opt/php70/libexec/apache2/libphp7.so
#LoadModule php7_module        /usr/local/opt/php71/libexec/apache2/libphp7.so
</code></pre></div><p>并在下面添加：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#080;font-style:italic">#Brew PHP LoadModule for `sphp` switcher</span>
<span style="color:#080;font-style:italic">#LoadModule php5_module /usr/local/lib/libphp5.so</span>
LoadModule php7_module /usr/local/lib/libphp7.so
</code></pre></div><p>如果你安装了 PHP 5.5 或 5.6 等，注释掉的 <code>php5_module</code> 同样也非常重要。<code>PHP switcher script</code> 会自动注释或取消注释 PHP module。</p>
<h3 id="36-php-切换测试">3.6 PHP 切换测试 <a href="#36-php-%e5%88%87%e6%8d%a2%e6%b5%8b%e8%af%95" class="anchor">🔗</a></h3><p>完成上面的步骤之后，就可以使用 <code>sphp</code> 命令来切换 PHP 版本了。<code>sphp</code> 的参数是由两个数字组合成的两位数：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sphp <span style="color:#666">55</span>
PHP version <span style="color:#666">55</span> found
Unlinking old binaries...
Linking new binaries...
Linking /usr/local/Cellar/php55/5.5.38_11... <span style="color:#666">17</span> symlinks created
Linking new modphp addon...
/usr/local/lib/libphp5.so
Fixing LoadModule...
Updating version file...
Restarting homebrew Apache...
Done.

PHP 5.5.38 <span style="color:#666">(</span>cli<span style="color:#666">)</span> <span style="color:#666">(</span>built: Dec <span style="color:#666">28</span> <span style="color:#666">2016</span> 15:48:28<span style="color:#666">)</span>
Copyright <span style="color:#666">(</span>c<span style="color:#666">)</span> 1997-2015 The PHP Group
Zend Engine v2.5.0, Copyright <span style="color:#666">(</span>c<span style="color:#666">)</span> 1998-2015 Zend Technologies
</code></pre></div><p>然后访问 <code>http://localhost:7070/info.php</code>，可以看到 PHP 版本已经正确切换：</p>
<p><p class="markdown-image">
  <img src="./images/macOS-Sierra-Apache-Multiple-PHP-versions-php-information-page-sphp.png" alt="macOS-Sierra-Apache-Multiple-PHP-versions-php-information-page-sphp"  />
</p></p>
<h4 id="361-issue-unable-to-load-dynamic-library-usrlocaloptphp56-mongomongoso">3.6.1 ISSUE Unable to load dynamic library &lsquo;/usr/local/opt/php56-mongo/mongo.so&rsquo; <a href="#361-issue-unable-to-load-dynamic-library-usrlocaloptphp56-mongomongoso" class="anchor">🔗</a></h4><p>我在切换版本的时候也遇到了问题：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sphp <span style="color:#666">71</span>
...
Warning: PHP Startup: Unable to load dynamic library <span style="color:#b44">&#39;/usr/local/opt/php56-mongo/mongo.so&#39;</span> - dlopen<span style="color:#666">(</span>/usr/local/opt/php56-mongo/mongo.so, 9<span style="color:#666">)</span>: image not found in Unknown on line <span style="color:#666">0</span>
PHP 5.6.29 <span style="color:#666">(</span>cli<span style="color:#666">)</span> <span style="color:#666">(</span>built: Dec <span style="color:#666">28</span> <span style="color:#666">2016</span> 15:58:30<span style="color:#666">)</span>
Copyright <span style="color:#666">(</span>c<span style="color:#666">)</span> 1997-2016 The PHP Group
Zend Engine v2.6.0, Copyright <span style="color:#666">(</span>c<span style="color:#666">)</span> 1998-2016 Zend Technologies
</code></pre></div><p>根据错误提示，大概是因为 <code>php56-mongo</code> 这个扩展没有，于是我使用 brew 安装了 <code>php56-mongo</code> 问题就解决了：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew install php56-mongo
</code></pre></div><h3 id="37-更新-php-和其他通过-brew-安装的程序">3.7 更新 PHP 和其他通过 Brew 安装的程序 <a href="#37-%e6%9b%b4%e6%96%b0-php-%e5%92%8c%e5%85%b6%e4%bb%96%e9%80%9a%e8%bf%87-brew-%e5%ae%89%e8%a3%85%e7%9a%84%e7%a8%8b%e5%ba%8f" class="anchor">🔗</a></h3><p>使用 brew 更新 PHP 和其他通过 brew 安装的程序非常简单，第一步是更新 brew 本身：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew update
</code></pre></div><p>升级后将会列出一系列可测回归内心的程序，然后使用下面的命令更新：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew upgrade
</code></pre></div><h3 id="38-使用具体的最新的-php-版本">3.8 使用具体的/最新的 PHP 版本 <a href="#38-%e4%bd%bf%e7%94%a8%e5%85%b7%e4%bd%93%e7%9a%84%e6%9c%80%e6%96%b0%e7%9a%84-php-%e7%89%88%e6%9c%ac" class="anchor">🔗</a></h3><p>当我们使用 PHP 的时候，每次我们只使用了其中一个版本，并且只有当前使用的版本会更新到最新版本。可以使用下面的命令查看当前 PHP 版本：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ php -v
</code></pre></div><p>可以使用下面的命令查看具体的可用 PHP 版本：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew info php55
homebrew/php/php55: stable 5.5.38 <span style="color:#666">(</span>bottled<span style="color:#666">)</span>, HEAD
PHP Version 5.5
https://php.net
Conflicts with: php53, php54, php56, php70, php71
/usr/local/Cellar/php55/5.5.38_11 <span style="color:#666">(</span><span style="color:#666">329</span> files, 47.7M<span style="color:#666">)</span>
  Built from <span style="color:#a2f">source</span> on 2016-12-28 at 15:49:20 with: --with-httpd24
</code></pre></div><p>比如上面的 PHP 5.5 版本的只有一个可用版本 5.5.38。</p>
<p>然后可以使用 brew 来切换到一个具体的版本：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew switch php55 5.5.38
</code></pre></div><p>到此，这篇文章就结束了。你已经完成掌握了 Apache 2.4 和各个版本 PHP 的安装，并且能够在 5.5 5.6 7.0 7.1 中快速切换 PHP 版本。原作者还写了两外两篇文章，分别是 <a href="https://getgrav.org/blog/macos-sierra-apache-mysql-vhost-apc" target="_blank" rel="noopener">macOS 10.12 Sierra Apache Setup: MySQL, APC &amp; More</a> 和 <a href="https://getgrav.org/blog/macos-sierra-apache-ssl" target="_blank" rel="noopener">macOS 10.12 Sierra Apache Setup: SSL</a>，近期内我也会将它们翻译成中文，并加入自己的实践总结。</p>
<h2 id="4-更新">4. 更新 <a href="#4-%e6%9b%b4%e6%96%b0" class="anchor">🔗</a></h2><h3 id="41-homebrewdupes-was-deprecated">4.1 homebrew/dupes was deprecated <a href="#41-homebrewdupes-was-deprecated" class="anchor">🔗</a></h3><p>在 1.1 需要添加第三方库 <code>brew tap homebrew/dupes</code> 的时候，由于有些软件 macOS 已经有了，有一些移动到了 <code>homebrew-core</code> 所以不再需要添加了。详见 <a href="https://github.com/Homebrew/homebrew-dupes" target="_blank" rel="noopener">Homebrew/homebrew-dupes</a>。</p>
<blockquote>
<p>These formulae were those that duplicated software provided by macOS.
All formulae were migrated to Homebrew/homebrew-core or deleted.</p>
</blockquote>
<p>如果执行这个命令，就会有如下警告：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew tap homebrew/dupes
Warning: homebrew/dupes was deprecated. This tap is now empty as all its formulae were migrated.
</code></pre></div><h3 id="42-warning-homebrewversions-was-deprecated">4.2 Warning: homebrew/versions was deprecated. <a href="#42-warning-homebrewversions-was-deprecated" class="anchor">🔗</a></h3><p>同理，还有 <code>homebrew/versions</code> 也不需要添加了。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew tap homebrew/versions
Updating Homebrew...
<span style="color:#666">==</span>&gt; Auto-updated Homebrew!
Updated <span style="color:#666">1</span> tap <span style="color:#666">(</span>caskroom/cask<span style="color:#666">)</span>.
No changes to formulae.

Warning: homebrew/versions was deprecated. This tap is now empty as all its formulae were migrated.
</code></pre></div><h3 id="43---with-http2-was-deprecated-using---with-nghttp2-instead">4.3 &ndash;with-http2 was deprecated; using &ndash;with-nghttp2 instead <a href="#43---with-http2-was-deprecated-using---with-nghttp2-instead" class="anchor">🔗</a></h3><p>Warning: homebrew/apache/httpd24: &ndash;with-http2 was deprecated; using &ndash;with-nghttp2 instead!
Warning: homebrew/apache/httpd24: this formula has no &ndash;with-nghttp2 option so it will be ignored!</p>
<h3 id="44-apache-和-php-的配置---第二部分">4.4 Apache 和 PHP 的配置 - 第二部分 <a href="#44-apache-%e5%92%8c-php-%e7%9a%84%e9%85%8d%e7%bd%ae---%e7%ac%ac%e4%ba%8c%e9%83%a8%e5%88%86" class="anchor">🔗</a></h3><p>在 <code>3.5. Apache 和 PHP 的配置 - 第二部分</code> 部分，不修改配置文件也可以。</p>
<hr>
<p>Github Issue: <a href="https://github.com/nodejh/nodejh.github.io/issues/25" target="_blank" rel="noopener">https://github.com/nodejh/nodejh.github.io/issues/25</a></p>

    </div>

    
        <div class="tags">
            
                <a href="https://nodejh.com/tags/macos">macOS</a>
            
        </div>
    
    
    
  <div id="comment">
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "nodejh" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>


</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/nodejh" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://stackoverflow.com/users/4518882/nodejh" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>stackoverflow</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-488.000000, -1163.000000)">
            <g id="stackoverflow" transform="translate(488.000000, 1163.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M42.0860128,53.5922927 L22.9745951,53.6011499 L22.9729497,49.5538824 L42.0835447,49.5440929 L42.0860128,53.5922927 L42.0860128,53.5922927 Z M55,30.6708298 L51.7306912,12 L47.7087256,12.6920259 L50.9775643,31.3628557 L55,30.6708298 L55,30.6708298 Z M42.5455518,44.3547147 L23.5156994,42.616026 L23.1410164,46.6470941 L42.1712214,48.3841513 L42.5455518,44.3547147 L42.5455518,44.3547147 Z M43.8009984,39.0731519 L25.3459811,34.1539179 L24.285633,38.0621508 L42.7419431,42.9819676 L43.8009984,39.0731519 L43.8009984,39.0731519 Z M46.2103463,34.4436411 L29.7494464,24.8164635 L27.6748215,28.3015328 L44.1365441,37.9292931 L46.2103463,34.4436411 L46.2103463,34.4436411 Z M50.2466504,31.6088756 L46.8745036,33.8883189 L36.106599,18.2318456 L39.4792159,15.9517031 L50.2466504,31.6088756 Z M45.3315807,40.2784283 L48.5799693,40.2784283 L48.5799693,60 L17,60 L17,40.2784283 L20.2648427,40.2784283 L20.2648427,56.8243495 L45.3315807,56.8243495 L45.3315807,40.2784283 Z" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://twitter.com/nodejh" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <div class="copyright">
    
       © Copyright 
       2021 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Hang Jiang
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-cactus-plus'>nodejh</a>
      </div>
    
</footer>



  </body>
</html>
