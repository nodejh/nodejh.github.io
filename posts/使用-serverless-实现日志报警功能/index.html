<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <title>ä½¿ç”¨ Serverless å®ç°æ—¥å¿—æŠ¥è­¦ | Hang Jiang</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="AJAX: XHR, jQuery and Fetch API">
<meta name="generator" content="Hugo 0.82.0" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />






  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>é¦–é¡µ</a>
	
	<a href="/posts">å½’æ¡£</a>
	<a href="/tags">æ ‡ç­¾</a>
	<a href="/about">å…³äº</a>

	

	
	<a class="button" href="https://nodejh.com/index.xml">è®¢é˜…</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">ä½¿ç”¨ Serverless å®ç°æ—¥å¿—æŠ¥è­¦</h1>

    <div class="tip">
        <span>
          Aug 8, 2017 22:24
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          
            5330 words
          
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          11 minute read
        </span>
    </div>

    <div class="content">
      <p>æœ€è¿‘å°è¯•å°†åº”ç”¨çš„é¡µé¢ JS é”™è¯¯æŠ¥è­¦åŠŸèƒ½é€šè¿‡ Serverless æ¥å®ç°ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹å…·ä½“å®ç°è¿‡ç¨‹ï¼Œä»¥åŠé‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p>
<p>æŠ¥è­¦åŠŸèƒ½çš„éœ€æ±‚ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å®šæ—¶ï¼ˆå¦‚æ¯éš” 1 åˆ†é’Ÿï¼‰å»è¯»å– ARMS çš„é”™è¯¯æ—¥å¿—ï¼Œå¦‚æœæœ‰é”™è¯¯æ—¥å¿—ï¼Œåˆ™é€šè¿‡é’‰é’‰æ¶ˆæ¯å‘é€é”™è¯¯è¯¦æƒ…è¿›è¡ŒæŠ¥è­¦ã€‚</p>
<p>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘é€šè¿‡å®šæ—¶ä»»åŠ¡å®ç°äº†è¯¥åŠŸèƒ½ã€‚ä»æˆæœ¬ä¸Šæ¥è¯´ï¼Œè¿™ç§æ–¹æ¡ˆå°±éœ€è¦å•ç‹¬ç”³è¯·ä¸€å°æœåŠ¡å™¨èµ„æºï¼›è€Œä¸”å®šæ—¶ä»»åŠ¡åªåœ¨å¯¹åº”çš„æ—¶é—´æ‰æ‰§è¡Œï¼Œè¿™ä»¶æ„å‘³ç€ï¼ŒæœåŠ¡å™¨æœ‰å¾ˆé•¿çš„æ—¶é—´éƒ½æ˜¯ç©ºé—²çš„ï¼Œè¿™å°±é€ æˆäº†èµ„æºçš„æµªè´¹ã€‚è€Œä½¿ç”¨ Serverlessï¼Œå°±ä¸éœ€è¦å†ç”³è¯·æœåŠ¡å™¨ï¼Œå‡½æ•°åªéœ€è¦åœ¨éœ€è¦çš„æ—¶å€™æ‰§è¡Œï¼Œè¿™å°±å¤§å¤§èŠ‚çœäº†æˆæœ¬ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œæˆ‘è§‰å¾—å‡½æ•°è®¡ç®—çš„ä¼˜åŠ¿å°±æ˜¯ï¼š</p>
<ul>
<li>å¯¹äºå¼€å‘è€…ï¼Œåªéœ€è¦å…³ç³»ä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œä¸éœ€è¦å…³å¿ƒä»£ç æ‰€è¿è¡Œçš„ç¯å¢ƒã€ç¡¬ä»¶èµ„æºã€ä»¥åŠè¿ç»´</li>
<li>èŠ‚çœæˆæœ¬</li>
</ul>
<p>é€šè¿‡ Serverless å®ç°å‰ç«¯æ—¥å¿—æŠ¥è­¦ï¼Œä¾èµ–çš„äº‘æœåŠ¡æ˜¯<a 
    href="https://fc.console.aliyun.com"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—
</a>ï¼Œä¾èµ–çš„å…¶ä»–å·¥å…·è¿˜æœ‰ï¼š</p>
<ul>
<li>å‡½æ•°è®¡ç®—çš„å‘½ä»¤è¡Œå·¥å…· <a 
    href="https://github.com/aliyun/fun"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    fun
</a>ï¼Œç”¨äºæœ¬åœ°è°ƒè¯•ã€éƒ¨ç½²å‡½æ•°</li>
<li>å‡½æ•°è®¡ç®—çš„å¯äº¤äº’å¼å·¥å…· <a 
    href="https://github.com/aliyun/fcli"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    fcli
</a>ï¼Œç”¨äºæœ¬åœ°æµ‹è¯•</li>
<li>é˜¿é‡Œäº‘ JS SDK <a 
    href="https://github.com/aliyun-UED/aliyun-sdk-js"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    aliyun-sdk-js
</a>ï¼Œç”¨äºè¯»å– SLS æ—¥å¿—ï¼ŒARMS çš„æ—¥å¿—æ˜¯å­˜å‚¨åœ¨ SLS ä¸­çš„</li>
<li>ç¼–ç¨‹è¯­è¨€ä½¿ç”¨ Node.js</li>
</ul>
<h2 id="å®‰è£…å’Œé…ç½®-fun">å®‰è£…å’Œé…ç½® fun <a href="#%e5%ae%89%e8%a3%85%e5%92%8c%e9%85%8d%e7%bd%ae-fun" class="anchor">ğŸ”—</a></h2><p>åˆæ¬¡ä½¿ç”¨éœ€è¦å…ˆå®‰è£… <code>fun</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ npm install @alicloud/fun -g
</code></pre></div><p>å®‰è£…å®Œæˆä¹‹åï¼Œéœ€è¦é€šè¿‡ <code>fun config</code> é…ç½®ä¸€ä¸‹è´¦å·ä¿¡æ¯ <code>Aliyun Account ID</code> <code>Aliyun Access Key ID</code> <code>Aliyun Secret Access Key</code> ä»¥åŠé»˜è®¤çš„åœ°åŸŸã€‚åœ°åŸŸè¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ SLS è®°å½•å‡½æ•°æ—¥å¿—ï¼Œåˆ™éœ€è¦ SLS å’Œå‡½æ•°æœåŠ¡åœ¨åŒä¸€ä¸ªåœ°åŸŸã€‚è¿™é‡Œç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun config
? Aliyun Account ID ******
? Aliyun Access Key ID ******
? Aliyun Secret Access Key ******
? Default region name cn-shanghai
? The timeout in seconds <span style="color:#a2f;font-weight:bold">for</span> each SDK client invoking <span style="color:#666">60</span>
? The maximum number of retries <span style="color:#a2f;font-weight:bold">for</span> each SDK client <span style="color:#666">6</span>
</code></pre></div><p><code>Aliyun Account ID</code> <code>Aliyun Access Key ID</code> <code>Aliyun Secret Access Key</code> å¯ä»¥åœ¨é˜¿é‡Œäº‘çš„æ§åˆ¶å°ä¸­æŸ¥æ‰¾å’Œè®¾ç½®ã€‚</p>
<p><a 
    href="https://account.console.aliyun.com/#/secure"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    <code>Aliyun Account ID</code>
</a></p>
<p>![Aliyun Account ID]
<p class="markdown-image">
  <img src="./images/serverless-log-alarm-1.jpg" alt="accountid"  />
</p></p>
<p><a 
    href="https://usercenter.console.aliyun.com/#/manage/ak"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    <code>Aliyun Access Key ID</code> <code>Aliyun Secret Access Key</code>
</a></p>
<p><p class="markdown-image">
  <img src="./images/serverless-log-alarm-2.jpg" alt="accesskey"  />
</p></p>
<h2 id="å‡½æ•°åˆå§‹åŒ–">å‡½æ•°åˆå§‹åŒ– <a href="#%e5%87%bd%e6%95%b0%e5%88%9d%e5%a7%8b%e5%8c%96" class="anchor">ğŸ”—</a></h2><p>å…ˆé€šè¿‡ <code>fun</code> åˆ›å»ºä¸€ä¸ª Node.js çš„ demoï¼Œä¹‹åå¯ä»¥åœ¨è¿™ä¸ª demo çš„åŸºç¡€ä¸Šè¿›è¡Œå¼€å‘ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun init -n alarm helloworld-nodejs8
Start rendering template...
+ /Users/jh/inbox/func/code/alarm
+ /Users/jh/inbox/func/code/alarm/index.js
+ /Users/jh/inbox/func/code/alarm/template.yml
finish rendering template.
</code></pre></div><p>æ‰§è¡ŒæˆåŠŸåï¼Œåˆ†åˆ«åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶ <code>index.js</code> å’Œ <code>template.yml</code>ã€‚</p>
<p>å…¶ä¸­ <code>template.yml</code> æ˜¯å‡½æ•°çš„è§„èŒƒæ–‡æ¡£ï¼Œåœ¨é‡Œé¢å®šä¹‰äº†å‡½æ•°éœ€è¦çš„èµ„æºã€è§¦å‘å‡½æ•°çš„äº‹ä»¶ç­‰ç­‰ã€‚</p>
<h3 id="templateyml">template.yml <a href="#templateyml" class="anchor">ğŸ”—</a></h3><p>æ¥ä¸‹æ¥ç®€å•çœ‹çœ‹ç”Ÿæˆçš„é»˜è®¤çš„ <code>template.yml</code> é…ç½®æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#008000;font-weight:bold">ROSTemplateFormatVersion</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;2015-09-01&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Transform</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless-2018-04-03&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">alarm</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Service&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Description</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;helloworld&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">alarm</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Function&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Handler</span>:<span style="color:#bbb"> </span>index.handler<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Runtime</span>:<span style="color:#bbb"> </span>nodejs8<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">CodeUri</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;index.js&#39;</span><span style="color:#bbb">
</span></code></pre></div><p>é¦–å…ˆå®šä¹‰äº†è§„èŒƒæ–‡æ¡£çš„ç‰ˆæœ¬ <code>ROSTemplateFormatVersion</code> å’Œ <code>Transform</code>ï¼Œè¿™ä¸¤ä¸ªéƒ½ä¸ç”¨ä¿®æ”¹ã€‚</p>
<p><code>Resources</code> é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>alarm</code> çš„å‡½æ•°æœåŠ¡ï¼ˆ<code>Type: Aliyun::Serverless::Service</code> è¡¨ç¤ºè¯¥å±æ€§ä¸ºå‡½æ•°æœåŠ¡ï¼‰ï¼Œå¹¶ä¸”è¯¥æœåŠ¡é‡Œé¢å®šä¹‰äº†åä¸º <code>alarm</code> çš„å‡½æ•°ï¼ˆ<code>Type: 'Aliyun::Serverless::Function'</code>è¡¨ç¤ºè¯¥å±æ€§ä¸ºå‡½æ•°ï¼‰ã€‚</p>
<p>å‡½æ•°æœåŠ¡é‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªå‡½æ•°ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªå‡½æ•°ç»„ã€‚åé¢æˆ‘ä»¬ä¼šæåˆ°çš„å‡½æ•°æ—¥å¿—ï¼Œæ˜¯é…ç½®åˆ°å‡½æ•°æœåŠ¡ä¸Šçš„ã€‚å‡½æ•°æœåŠ¡é‡Œé¢çš„æ‰€æœ‰å‡½æ•°ï¼Œéƒ½ç”¨åŒä¸€ä¸ªæ—¥å¿—ã€‚</p>
<p>å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‡½æ•°æœåŠ¡åå’Œå‡½æ•°åã€‚ä¸‹é¢å°±å°†å‡½æ•°æœåŠ¡åç§°æ”¹ä¸º <code>yunzhi</code>ï¼Œå‡½æ•°åä¾æ—§ä¿ç•™ä¸º <code>alarm</code>ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#008000;font-weight:bold">ROSTemplateFormatVersion</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;2015-09-01&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Transform</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless-2018-04-03&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">yunzhi</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°æœåŠ¡çš„åç§°</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Service&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># è¡¨ç¤º yunzhi æ˜¯ä¸€ä¸ªå‡½æ•°æœåŠ¡</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Description</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;helloworld&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°æœåŠ¡çš„æè¿°</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">alarm</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°çš„åç§°</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Function&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># è¡¨ç¤º alarm æ˜¯ä¸€ä¸ªå‡½æ•°</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Handler</span>:<span style="color:#bbb"> </span>index.handler<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°çš„è°ƒç”¨å…¥å£</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Runtime</span>:<span style="color:#bbb"> </span>nodejs8<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°çš„è¿è¡Œç¯å¢ƒ</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">CodeUri</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;index.js&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># ä»£ç çš„ç›®å½•</span><span style="color:#bbb">
</span></code></pre></div><p><code>alarm</code> å‡½æ•°é‡Œé¢çš„ <code>Properties</code> å®šä¹‰äº†å‡½æ•°çš„è°ƒç”¨å…¥å£ã€è¿è¡Œç¯å¢ƒç­‰ï¼Œå¦‚ä¸Šé¢çš„æ³¨é‡Šæ‰€ç¤ºã€‚</p>
<p>å…³äº <code>template.yml</code> çš„é…ç½®è¯¦è§ <a 
    href="https://github.com/aliyun/fun/blob/master/docs/specs/2018-04-03-zh-cn.md"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    Serverless Application Model
</a>ã€‚</p>
<h3 id="indexjs">index.js <a href="#indexjs" class="anchor">ğŸ”—</a></h3><p><code>index.js</code> æ–‡ä»¶å°±æ˜¯å‡½æ•°çš„è°ƒç”¨å…¥å£äº†ã€‚<code>index.handler</code> å°±è¡¨ç¤ºï¼Œå‡½æ•°çš„è°ƒç”¨çš„æ˜¯ <code>index.[extension]</code> æ–‡ä»¶ä¸­çš„ <code>handler</code> å‡½æ•°ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">module.exports.handler <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">function</span>(event, context, callback) { 
  console.log(<span style="color:#b44">&#39;hello world&#39;</span>);
  callback(<span style="color:#a2f;font-weight:bold">null</span>, <span style="color:#b44">&#39;hello world&#39;</span>); 
};
</code></pre></div><p>åˆå§‹åŒ–ä¹‹åçš„ä»£ç å°±ä¸Šé¢è¿™å‡ è¡Œï¼Œå¾ˆç®€å•ã€‚ä¸»è¦æ˜¯ç†è§£ä¸Šé¢çš„å‡ ä¸ªå‚æ•°ã€‚</p>
<ul>
<li><code>event</code> è°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°</li>
<li><code>context</code> å‡½æ•°è¿è¡Œæ—¶çš„ä¸€äº›ä¿¡æ¯</li>
<li><code>callback</code> å‡½æ•°æ‰§è¡Œä¹‹åçš„å›è°ƒ
<ul>
<li>
<ol>
<li>å¿…é¡»è¦è¦è°ƒç”¨ <code>callback</code> å‡½æ•°ï¼Œæ‰ä¼šè¢«è®¤ä¸ºå‡½æ•°æ‰§è¡Œç»“æŸã€‚å¦‚æœæ²¡æœ‰è°ƒç”¨ï¼Œåˆ™å‡½æ•°ä¼šä¸€ç›´è¿è¡Œåˆ°è¶…æ—¶</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>callback</code> è°ƒç”¨ä¹‹åï¼Œå‡½æ•°å°±ç»“æŸäº†</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>callback</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>error</code> å¯¹è±¡ï¼Œè¿™å’Œ JS å›è°ƒç¼–ç¨‹çš„æ€æƒ³ä¸€è‡´</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>å…³äº <code>event</code> å’Œ <code>context</code>ï¼Œè¯¦è§ <a 
    href="https://help.aliyun.com/document_detail/74757.html"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    Nodejs å‡½æ•°å…¥å£
</a>ã€‚</p>
<p>å®ç°æŠ¥è­¦åŠŸèƒ½çš„ä¸»è¦é€»è¾‘ï¼Œå°±å†™åœ¨ <code>index.js</code> é‡Œé¢ã€‚å…·ä½“çš„å®ç°ï¼Œå°±ä¸ç»†è¯´ï¼Œä¸‹é¢ç”¨ä¼ªä»£ç æ¥æè¿°ï¼š</p>
<p><code>alarm/alarm.js</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#080;font-style:italic">// alarm/alarm.js 
</span><span style="color:#080;font-style:italic">// å®ç°æŠ¥è­¦åŠŸèƒ½
</span><span style="color:#080;font-style:italic"></span>module.exports <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">function</span>() {
	<span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f;font-weight:bold">new</span> <span style="color:#a2f">Promise</span>((resolve, reject) =&gt; {
		<span style="color:#080;font-style:italic">// æŸ¥è¯¢ SLS æ—¥å¿—
</span><span style="color:#080;font-style:italic"></span>		<span style="color:#080;font-style:italic">// - å¦‚æœæ²¡æœ‰é”™è¯¯æ—¥å¿—ï¼Œåˆ™ resolve
</span><span style="color:#080;font-style:italic"></span>		<span style="color:#080;font-style:italic">// - å¦‚æœæœ‰é”™è¯¯æ—¥å¿—ï¼Œåˆ™å‘é€é’‰é’‰æ¶ˆæ¯
</span><span style="color:#080;font-style:italic"></span>		<span style="color:#080;font-style:italic">// 		- å¦‚æœé’‰é’‰æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œåˆ™ reject
</span><span style="color:#080;font-style:italic"></span>		<span style="color:#080;font-style:italic">// 		- å¦‚æœé’‰é’‰æ¶ˆæ¯å‘é€æˆåŠŸï¼Œåˆ™ resolve
</span><span style="color:#080;font-style:italic"></span>		resolve();
	})
}
</code></pre></div><p><code>alarm/index.js</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#080;font-style:italic">// alarm/index.js 
</span><span style="color:#080;font-style:italic">// è°ƒç”¨æŠ¥è­¦å‡½æ•°
</span><span style="color:#080;font-style:italic"></span><span style="color:#a2f;font-weight:bold">const</span> alarm <span style="color:#666">=</span> require(<span style="color:#b44">&#39;./alarm&#39;</span>);

module.exports.handler <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">function</span>(event, context, callback) { 
  alarm()
  	.then(() =&gt; {
			callback(<span style="color:#a2f;font-weight:bold">null</span>, <span style="color:#b44">&#39;success&#39;</span>);   
  	})
  	.<span style="color:#a2f;font-weight:bold">catch</span>(error =&gt; {
			callback(error); 
		})
};
</code></pre></div><h4 id="codeuri">CodeUri <a href="#codeuri" class="anchor">ğŸ”—</a></h4><p>å¦‚æœå‡½æ•°é‡Œé¢å¼•å…¥äº†è‡ªå®šä¹‰çš„å…¶ä»–æ¨¡å—ï¼Œæ¯”å¦‚åœ¨ <code>index.js</code> é‡Œé¢å¼•å…¥äº† <code>alarm.js</code> <code>const alarm = require('./alarm');</code>ï¼Œåˆ™éœ€è¦ä¿®æ”¹é»˜è®¤çš„ <code>codeUri</code> ä¸ºå½“å‰ä»£ç ç›®å½• <code>./</code>ã€‚å¦åˆ™é»˜è®¤çš„ <code>codeUri</code> åªå®šä¹‰äº† <code>index.js</code>ï¼Œéƒ¨ç½²çš„æ—¶å€™åªä¼šéƒ¨ç½² <code>index.js</code>ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#008000;font-weight:bold">ROSTemplateFormatVersion</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;2015-09-01&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Transform</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless-2018-04-03&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">yunzhi</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°æœåŠ¡çš„åç§°</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Service&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># è¡¨ç¤º yunzhi æ˜¯ä¸€ä¸ªå‡½æ•°æœåŠ¡</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Description</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;helloworld&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°æœåŠ¡çš„æè¿°</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">alarm</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°çš„åç§°</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Function&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># è¡¨ç¤º alarm æ˜¯ä¸€ä¸ªå‡½æ•°</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Handler</span>:<span style="color:#bbb"> </span>index.handler<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°çš„è°ƒç”¨å…¥å£</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Runtime</span>:<span style="color:#bbb"> </span>nodejs8<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># å‡½æ•°çš„è¿è¡Œç¯å¢ƒ</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">CodeUri</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;./&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># ä»£ç çš„ç›®å½•</span><span style="color:#bbb">
</span></code></pre></div><p>å¦‚æœæ²¡æœ‰ä¿®æ”¹ <code>CodeUri</code>ï¼Œåˆ™ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„æŠ¥é”™</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun <span style="color:#a2f">local</span> invoke alarm
FC Invoke End RequestId: 16e3099e-6a40-43cb-99a0-f0c75f3422c6
<span style="color:#666">{</span>
  <span style="color:#b44">&#34;errorMessage&#34;</span>: <span style="color:#b44">&#34;Cannot find module &#39;./alarm&#39;&#34;</span>,
  <span style="color:#b44">&#34;errorType&#34;</span>: <span style="color:#b44">&#34;Error&#34;</span>,
  <span style="color:#b44">&#34;stackTrace&#34;</span>: <span style="color:#666">[</span>
    <span style="color:#b44">&#34;Error: Cannot find module &#39;./alarm&#39;&#34;</span>,
    <span style="color:#b44">&#34;at Module._resolveFilename (module.js:536:15)&#34;</span>,
    <span style="color:#b44">&#34;at Module._load (module.js:466:25)&#34;</span>,
    <span style="color:#b44">&#34;at Module.require (module.js:579:17)&#34;</span>,
    <span style="color:#b44">&#34;at require (internal/module.js:11:18)&#34;</span>,
    <span style="color:#b44">&#34;at (/code/index.js:9:15)&#34;</span>,
    <span style="color:#b44">&#34;at Module._compile (module.js:635:30)&#34;</span>,
    <span style="color:#b44">&#34;at Module._extensions..js (module.js:646:10)&#34;</span>,
    <span style="color:#b44">&#34;at Module.load (module.js:554:32)&#34;</span>,
    <span style="color:#b44">&#34;at tryModuleLoad (module.js:497:12)&#34;</span>,
    <span style="color:#b44">&#34;at Module._load (module.js:489:3)&#34;</span>
  <span style="color:#666">]</span>
<span style="color:#666">}</span>
</code></pre></div><p><code>fun local invoke alarm</code> æ˜¯æœ¬åœ°è°ƒè¯•çš„å‘½ä»¤ï¼Œæ¥ä¸‹æ¥ä¼šè®²åˆ°ã€‚</p>
<h2 id="æœ¬åœ°è°ƒè¯•">æœ¬åœ°è°ƒè¯• <a href="#%e6%9c%ac%e5%9c%b0%e8%b0%83%e8%af%95" class="anchor">ğŸ”—</a></h2><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè‚¯å®šéœ€è¦æœ¬åœ°è°ƒè¯•ã€‚<code>fun</code> æä¾›äº† <code>fun local</code> æ”¯æŒæœ¬åœ°è°ƒè¯•ã€‚</p>
<p><code>fun local</code> çš„å‘½ä»¤æ ¼å¼ä¸º <code>fun local invoke [options] &lt;[service/]function&gt;</code>ï¼Œå…¶ä¸­ <code>options</code> å’Œ <code>service</code> éƒ½å¯ä»¥å¿½ç•¥ã€‚æ¯”å¦‚è°ƒè¯•ä¸Šé¢çš„æŠ¥è­¦åŠŸèƒ½çš„å‘½ä»¤å°±æ˜¯ <code>fun local invoke alarm</code>ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬åœ°è°ƒè¯•éœ€è¦å…ˆå®‰è£… dockerã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew cask install docker
</code></pre></div><p>å®‰è£…æˆåŠŸåå¯åŠ¨ dockerã€‚</p>
<p>å¦‚æœ docker æ²¡æœ‰å¯åŠ¨ï¼Œè¿è¡Œ <code>fun local</code> å¯èƒ½ä¼šæœ‰å¦‚ä¸‹æŠ¥é”™</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun <span style="color:#a2f">local</span> invoke alarm
Reading event data from stdin, which can be ended with Enter <span style="color:#a2f;font-weight:bold">then</span> Ctrl+D
<span style="color:#666">(</span>you can also pass it from file with -e<span style="color:#666">)</span>
connect ENOENT /var/run/docker.sock
</code></pre></div><p>æ­£å¸¸çš„è¾“å‡ºå¦‚ä¸‹</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun <span style="color:#a2f">local</span> invoke alarm
Reading event data from stdin, which can be ended with Enter <span style="color:#a2f;font-weight:bold">then</span> Ctrl+D
<span style="color:#666">(</span>you can also pass it from file with -e<span style="color:#666">)</span>
skip pulling image aliyunfc/runtime-nodejs8:1.5.0...
FC Invoke Start RequestId: 9360768c-5c52-4bf5-978b-774edfce9e40
load code <span style="color:#a2f;font-weight:bold">for</span> handler:index.handler
FC Invoke End RequestId: 9360768c-5c52-4bf5-978b-774edfce9e40
success

RequestId: 9360768c-5c52-4bf5-978b-774edfce9e40          Billed Duration: <span style="color:#666">79</span> ms          Memory Size: <span style="color:#666">1998</span> MB    Max Memory Used: <span style="color:#666">54</span> MB
</code></pre></div><p>ç¬¬ä¸€æ¬¡è°ƒè¯•çš„è¯ï¼Œä¼šå®‰è£… runtime çš„é•œåƒï¼Œå¯èƒ½éœ€è¦ç‚¹æ—¶é—´ã€‚é»˜è®¤çš„ Docker é•œåƒä¸‹è½½ä¼šå¾ˆæ…¢ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…çš„åŠ é€Ÿç«™ç‚¹åŠ é€Ÿä¸‹è½½ã€‚</p>
<p>å‡ºç° <code>Reading event data from stdin, which can be ended with Enter then Ctrl+D</code> çš„æç¤ºæ—¶ï¼Œå¦‚æœä¸éœ€è¦è¾“å…¥ï¼Œå¯ä»¥æŒ‰ <code>ctrl+D</code> è·³è¿‡ã€‚</p>
<h2 id="å‡½æ•°éƒ¨ç½²">å‡½æ•°éƒ¨ç½² <a href="#%e5%87%bd%e6%95%b0%e9%83%a8%e7%bd%b2" class="anchor">ğŸ”—</a></h2><p>å¼€å‘å®Œæˆä¹‹åï¼Œå°±éœ€è¦å°†å‡½æ•°éƒ¨ç½²åˆ°é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—ä¸Šé¢äº†ã€‚éƒ¨ç½²å¯ä»¥é€šè¿‡ <code>fun deploy</code> å‘½ä»¤ã€‚</p>
<p>å‰é¢å·²ç»åœ¨å®‰è£… <code>fun</code> ä¹‹åï¼Œé€šè¿‡ <code>fun config</code> å‘½ä»¤é…ç½®äº†é˜¿é‡Œäº‘çš„è´¦å·å’Œåœ°åŸŸä¿¡æ¯ï¼Œ<code>fun deploy</code> ä¼šå°†å‡½æ•°è‡ªåŠ¨éƒ¨ç½²åˆ°å¯¹åº”çš„è´¦å·å’Œåœ°åŸŸä¸‹ã€‚</p>
<p>åœ¨ <code>template.yml</code> ä¸­ï¼Œä¹Ÿé…ç½®äº†å‡½æ•°çš„æœåŠ¡åå’Œå‡½æ•°åã€‚å¦‚æœåœ¨å‡½æ•°è®¡ç®—ä¸­æ²¡æœ‰å¯¹åº”çš„æœåŠ¡æˆ–å‡½æ•°ï¼Œ<code>fun deploy</code> ä¼šè‡ªåŠ¨åˆ›å»ºï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šæ›´æ–°ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun deploy
using region: cn-shanghai
using accountId: ***********4698
using accessKeyId: ***********UfpF
using timeout: <span style="color:#666">60</span>

Waiting <span style="color:#a2f;font-weight:bold">for</span> service yunzhi to be deployed...
        Waiting <span style="color:#a2f;font-weight:bold">for</span> <span style="color:#a2f;font-weight:bold">function</span> alarm to be deployed...
                Waiting <span style="color:#a2f;font-weight:bold">for</span> packaging <span style="color:#a2f;font-weight:bold">function</span> alarm code...
                package <span style="color:#a2f;font-weight:bold">function</span> alarm code <span style="color:#a2f;font-weight:bold">done</span>
        <span style="color:#a2f;font-weight:bold">function</span> alarm deploy success
service yunzhi deploy success
</code></pre></div><p>éƒ¨ç½²æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥åœ¨å‡½æ•°è®¡ç®—çš„æ§åˆ¶å°ä¸­çœ‹åˆ°å¯¹åº”çš„å‡½æ•°æœåŠ¡å’Œå‡½æ•°äº†ã€‚ç›®å‰è¿˜æ²¡æœ‰é…ç½®è§¦å‘å™¨ï¼Œå¯ä»¥æ‰‹åŠ¨åœ¨æ§åˆ¶å°ä¸­ç‚¹å‡»â€œæ‰§è¡Œâ€æŒ‰é’®æ¥æ‰§è¡Œå‡½æ•°ã€‚</p>
<p><p class="markdown-image">
  <img src="./images/serverless-log-alarm-3.jpg" alt="fcshow2"  />
</p></p>
<h2 id="è§¦å‘å™¨">è§¦å‘å™¨ <a href="#%e8%a7%a6%e5%8f%91%e5%99%a8" class="anchor">ğŸ”—</a></h2><p>å¯¹äºåº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒçš„å‡½æ•°ï¼Œè‚¯å®šä¸ä¼šåƒä¸Šé¢ä¸€æ ·æ‰‹åŠ¨å»æ‰§è¡Œå®ƒï¼Œè€Œæ˜¯é€šè¿‡é…ç½®è§¦å‘å™¨å»æ‰§è¡Œã€‚è§¦å‘å™¨å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶ï¼Œå½“å‡½æ•°è®¡ç®—æ¥æ”¶åˆ°è¯¥äº‹ä»¶çš„æ—¶å€™ï¼Œå°±å»è°ƒç”¨å¯¹åº”çš„å‡½æ•°ã€‚</p>
<p>é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—æ”¯æŒ HTTP è§¦å‘å™¨ï¼ˆæ¥æ”¶åˆ° HTTP è¯·æ±‚ä¹‹åè°ƒç”¨å‡½æ•°ï¼‰ã€å®šæ—¶è§¦å‘å™¨ï¼ˆå®šæ—¶è°ƒç”¨å‡½æ•°ï¼‰ã€OSS è§¦å‘å™¨ç­‰ç­‰ã€‚è¯¦è§ <a 
    href="https://help.aliyun.com/document_detail/74707.html"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    è§¦å‘å™¨åˆ—è¡¨
</a>ã€‚</p>
<p>å¯¹äºæŠ¥è­¦åŠŸèƒ½ï¼Œéœ€è¦ç”¨åˆ°çš„æ˜¯å®šæ—¶è§¦å‘å™¨ï¼Œå› ä¸ºéœ€è¦é—´éš”ä¸€å®šçš„æ—¶é—´å°±è°ƒç”¨å‡½æ•°ã€‚</p>
<p>è§¦å‘å™¨æ˜¯é…ç½®åˆ°å‡½æ•°ä¸­çš„ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°çš„ <code>Event</code> å±æ€§å»é…ç½®</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#008000;font-weight:bold">ROSTemplateFormatVersion</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;2015-09-01&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Transform</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless-2018-04-03&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">yunzhi</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Service&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Description</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;helloworld&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">alarm</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Function&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Handler</span>:<span style="color:#bbb"> </span>index.handler<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Runtime</span>:<span style="color:#bbb"> </span>nodejs8 <span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">CodeUri</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;./&#39;</span><span style="color:#bbb"> 
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Events</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># é…ç½® alarm å‡½æ•°çš„è§¦å‘å™¨</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">TimeTrigger</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># è§¦å‘å™¨çš„åç§°</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span>Timer<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># è¡¨ç¤ºè¯¥è§¦å‘å™¨æ˜¯å®šæ—¶è§¦å‘å™¨</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">CronExpression</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;0 0/1 * * * *&#34;</span><span style="color:#bbb">  </span><span style="color:#080;font-style:italic"># æ¯ 1 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">Enable</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># æ˜¯å¦å¯ç”¨è¯¥å®šæ—¶è§¦å‘å™¨</span><span style="color:#bbb">
</span></code></pre></div><p>ä¸Šé¢çš„é…ç½®ï¼Œå°±ä¸º <code>alarm</code> é…ç½®äº†ä¸€ä¸ªåä¸º <code>TimeTrigger</code> çš„å®šæ—¶è§¦å‘å™¨ï¼Œè§¦å‘å™¨æ¯éš” 1 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯æ¯éš” 1 åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡å‡½æ•°ã€‚</p>
<p>é…ç½®å®Œæˆä¹‹åï¼Œå†æ‰§è¡Œ <code>fun deploy</code> å°±å¯ä»¥å‘å¸ƒå‡½æ•°åŠè§¦å‘å™¨åˆ°å‡½æ•°è®¡ç®—ä¸Šã€‚</p>
<p><p class="markdown-image">
  <img src="./images/serverless-log-alarm-4.jpg" alt="trigger"  />
</p></p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æœåŠ¡ç›®å‰æ”¯æŒçš„è§¦å‘å™¨ï¼Œæœ€å°çš„é—´éš”æ—¶é—´ä¸º 1 åˆ†é’Ÿã€‚å¦‚æœå°äº 1 åˆ†é’Ÿï¼Œåˆ™æ— æ³•è®¾ç½®æˆåŠŸã€‚å®šæ—¶è§¦å‘å™¨çš„è¯¦ç»†ä»‹ç»å¯å‚è€ƒæ–‡æ¡£ <a 
    href="https://help.aliyun.com/document_detail/68172.html"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    å®šæ—¶è§¦å‘å‡½æ•°
</a>ã€‚</p>
<h2 id="å‡½æ•°æ—¥å¿—">å‡½æ•°æ—¥å¿— <a href="#%e5%87%bd%e6%95%b0%e6%97%a5%e5%bf%97" class="anchor">ğŸ”—</a></h2><p>å¯¹äº serverless åº”ç”¨ï¼Œè™½ç„¶ä¸ç”¨å…³å¿ƒè¿ç»´äº†ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„å‡½æ•°è¿è¡Œåœ¨å“ªå°æœåŠ¡å™¨ä¸Šã€‚è¿™ä¸ªæ—¶å€™ï¼Œå‡½æ•°çš„æ—¥å¿—å°±å°¤ä¸ºé‡è¦äº†ã€‚æ²¡æœ‰æ—¥å¿—ï¼Œæˆ‘ä»¬å¾ˆéš¾çŸ¥é“ç¨‹åºè¿è¡ŒçŠ¶æ€ï¼Œé‡åˆ°é—®é¢˜æ›´æ˜¯æ— ä»ä¸‹æ‰‹ã€‚</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥éœ€è¦å¯¹å‡½æ•°é…ç½®æ—¥å¿—ã€‚é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—å¯ä»¥ä½¿ç”¨<a 
    href="https://sls.console.aliyun.com/#/"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡ SLS
</a>æ¥å­˜å‚¨æ—¥å¿—ã€‚å¦‚æœè¦å­˜å‚¨æ—¥å¿—ï¼Œåˆ™éœ€è¦å…ˆå¼€é€š <a 
    href="https://sls.console.aliyun.com/#/"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    æ—¥å¿—æœåŠ¡
</a>ã€‚</p>
<h3 id="ä¸å­˜åœ¨æ—¥å¿—åº“">ä¸å­˜åœ¨æ—¥å¿—åº“ <a href="#%e4%b8%8d%e5%ad%98%e5%9c%a8%e6%97%a5%e5%bf%97%e5%ba%93" class="anchor">ğŸ”—</a></h3><p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¥å¿—æœåŠ¡ï¼Œåˆ™è‚¯å®šä¸å­˜åœ¨æ—¥å¿—åº“ã€‚å¯ä»¥åœ¨ <code>template.yml</code> åƒå®šä¹‰å‡½æ•°æœåŠ¡ä¸€æ ·ï¼Œé€šè¿‡ Resource æ¥å®šä¹‰æ—¥å¿—èµ„æºã€‚</p>
<p>å‰é¢ä¹Ÿæåˆ°ï¼Œå‡½æ•°æ—¥å¿—æ˜¯é…ç½®åˆ°å¯¹åº”çš„æœåŠ¡ä¸Šçš„ï¼Œå…·ä½“é…ç½®ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡å‡½æ•°æœåŠ¡çš„ <code>LogConfig</code> å±æ€§æ¥é…ç½®ã€‚</p>
<p>å®Œæ•´çš„ <code>template.yml</code> å¦‚ä¸‹</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#008000;font-weight:bold">ROSTemplateFormatVersion</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;2015-09-01&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Transform</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless-2018-04-03&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">log-yunzhi</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># æ—¥å¿—é¡¹ç›®åç§°ä¸º log-yunzhi</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Log&#39;</span><span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># è¡¨ç¤ºè¯¥èµ„æºæ˜¯é˜¿é‡Œäº‘çš„æ—¥å¿—æœåŠ¡</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Description</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;yunzhi function service log project&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">log-yunzhi-store</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># æ—¥å¿—çš„ logstore</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Log::Logstore&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">TTL</span>:<span style="color:#bbb"> </span><span style="color:#666">10</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">ShardCount</span>:<span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">log-another-logstore</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># æ—¥å¿—çš„å¦ä¸€ä¸ª logstore</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Log::Logstore&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">TTL</span>:<span style="color:#bbb"> </span><span style="color:#666">10</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">ShardCount</span>:<span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">yunzhi</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Service&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Description</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;helloworld&#39;</span><span style="color:#bbb"> 
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">LogConfig</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># é…ç½®å‡½æ•°çš„æ—¥å¿—</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Project: &#39;log-yunzhi&#39; # å­˜å‚¨å‡½æ•°æ—¥å¿— SLS é¡¹ç›®</span>:<span style="color:#bbb"> </span>log-yunzhi<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Logstore: &#39;log-yunzhi-store&#39; # å­˜å‚¨å‡½æ•°æ—¥å¿—çš„ SLS logstore</span>:<span style="color:#bbb"> </span>log-yunzhi-store<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">alarm</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Function&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Handler</span>:<span style="color:#bbb"> </span>index.handler <span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Runtime</span>:<span style="color:#bbb"> </span>nodejs8 <span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">CodeUri</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;./&#39;</span><span style="color:#bbb"> 
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Events</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">TimeTrigger</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span>Timer <span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">CronExpression</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;0 0/1 * * * *&#34;</span><span style="color:#bbb">  
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">Enable</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb"> 
</span><span style="color:#bbb">
</span></code></pre></div><p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œå°±å®šä¹‰äº†åä¸º <code>log-yunzhi</code> çš„æ—¥å¿—é¡¹ç›®ï¼ˆProjectï¼‰ï¼Œå¹¶ä¸”åœ¨è¯¥ Project ä¸­åˆ›å»ºäº†ä¸¤ä¸ªæ—¥å¿—ä»“åº“ï¼ˆLogStoreï¼‰ï¼š<code>log-yunzhi-store</code> å’Œ <code>log-yunzhi-store</code>ã€‚ä¸€ä¸ª Project å¯ä»¥åŒ…å«å¤šä¸ª LogStoreã€‚</p>
<p><strong>æ³¨æ„ï¼šæ—¥å¿—é¡¹ç›®çš„åç§°å¿…é¡»å…¨å±€å”¯ä¸€</strong>ã€‚ å³é…ç½®ä¸­ï¼Œ<code>og-yunzhi</code> è¿™ä¸ªé¡¹ç›®åç§°æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚</p>
<p>æ‰§è¡Œ <code>fun deploy</code> ä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨åœ¨å‡½æ•°æœåŠ¡å¯¹åº”çš„åœ°åŸŸåˆ›å»ºæ—¥å¿— Project åŠæ—¥å¿— logstoreï¼ŒåŒæ—¶ä¹Ÿä¼šè‡ªåŠ¨ä¸º logstore åŠ ä¸Šå…¨æ–‡ç´¢å¼•ï¼Œç„¶åè‡ªåŠ¨ä¸ºå‡½æ•°æœåŠ¡é…ç½®æ—¥å¿—ä»“åº“ã€‚</p>
<p>ä¹‹åå‡½æ•°çš„è¿è¡Œæ—¥å¿—éƒ½ä¼šå­˜å‚¨åœ¨å¯¹åº”çš„ logstore é‡Œã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun deploy
using region: cn-shanghai
using accountId: ***********4698
using accessKeyId: ***********UfpF
using timeout: <span style="color:#666">60</span>

Waiting <span style="color:#a2f;font-weight:bold">for</span> log service project log-yunzhi to be deployed...
        Waiting <span style="color:#a2f;font-weight:bold">for</span> log service logstore log-yunzhi-store to be deployed...
                retry <span style="color:#666">1</span> <span style="color:#a2f">times</span>
                Waiting <span style="color:#a2f;font-weight:bold">for</span> log service logstore log-yunzhi-store default index to be deployed...
                log service logstore log-yunzhi-store default index deploy success
        log serivce logstore log-yunzhi-store deploy success
        Waiting <span style="color:#a2f;font-weight:bold">for</span> log service logstore log-another-logstore to be deployed...
                Waiting <span style="color:#a2f;font-weight:bold">for</span> log service logstore log-another-logstore default index to be deployed...
                log service logstore log-another-logstore default index deploy success
        log serivce logstore log-another-logstore deploy success
log serivce project log-yunzhi deploy success

Waiting <span style="color:#a2f;font-weight:bold">for</span> service yunzhi to be deployed...
        Waiting <span style="color:#a2f;font-weight:bold">for</span> <span style="color:#a2f;font-weight:bold">function</span> alarm to be deployed...
                Waiting <span style="color:#a2f;font-weight:bold">for</span> packaging <span style="color:#a2f;font-weight:bold">function</span> alarm code...
                package <span style="color:#a2f;font-weight:bold">function</span> alarm code <span style="color:#a2f;font-weight:bold">done</span>
                Waiting <span style="color:#a2f;font-weight:bold">for</span> Timer trigger TimeTrigger to be deployed...
                <span style="color:#a2f;font-weight:bold">function</span> TimeTrigger deploy success
        <span style="color:#a2f;font-weight:bold">function</span> alarm deploy success
service yunzhi deploy success
</code></pre></div><p><p class="markdown-image">
  <img src="./images/serverless-log-alarm-5.jpg" alt="slslog"  />
</p></p>
<p>å¦‚æœæ—¥å¿—åº“å·²ç»å­˜åœ¨ï¼Œä¸”å®šä¹‰äº†æ—¥å¿—èµ„æºï¼Œåˆ™ <code>fun deploy</code> ä¼šæŒ‰ç…§ <code>template.yml</code> ä¸­çš„é…ç½®æ›´æ–°æ—¥å¿—åº“ã€‚</p>
<h3 id="å­˜åœ¨æ—¥å¿—åº“">å­˜åœ¨æ—¥å¿—åº“ <a href="#%e5%ad%98%e5%9c%a8%e6%97%a5%e5%bf%97%e5%ba%93" class="anchor">ğŸ”—</a></h3><p>å¦‚æœæ—¥å¿—åº“å·²ç»å­˜åœ¨ï¼Œå³å·²ç»åœ¨æ—¥å¿—æœåŠ¡ä¸­åˆ›å»ºäº†æ—¥å¿—é¡¹ç›® Project å’Œæ—¥å¿—åº“ Logstore ï¼Œå°±å¯ä»¥ç›´æ¥ä¸ºå‡½æ•°æœåŠ¡æ·»åŠ  LogConfigï¼Œä¸ç”¨å†å®šä¹‰æ—¥å¿—èµ„æºã€‚</p>
<p><strong>æ³¨æ„ï¼Œæ—¥å¿—åº“éœ€è¦å’Œå‡½æ•°æœåŠ¡åœ¨åŒä¸€ä¸ªåœ°åŸŸ Regionã€‚å¦åˆ™ä¸èƒ½éƒ¨ç½²æˆåŠŸã€‚</strong></p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®å‡½æ•°æ—¥å¿—åˆ°å·²ç»å­˜åœ¨çš„ Project å’Œ Logstore ä¸­çš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#008000;font-weight:bold">ROSTemplateFormatVersion</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;2015-09-01&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Transform</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless-2018-04-03&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">Resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">yunzhi</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Service&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Description</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;helloworld&#39;</span><span style="color:#bbb"> 
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">LogConfig</span>:<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># é…ç½®å‡½æ•°çš„æ—¥å¿—</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Project: &#39;log-yunzhi-exist&#39; # å­˜å‚¨å‡½æ•°æ—¥å¿—åˆ°å·²ç»å­˜åœ¨çš„ Project</span>:<span style="color:#bbb"> </span>log-yunzhi-exist<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Logstore: &#39;logstore-exist&#39; # å­˜å‚¨å‡½æ•°æ—¥å¿—åˆ°å·²ç»å­˜åœ¨çš„ logstore</span>:<span style="color:#bbb"> </span>logstore-exist<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">alarm</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;Aliyun::Serverless::Function&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Handler</span>:<span style="color:#bbb"> </span>index.handler <span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">Runtime</span>:<span style="color:#bbb"> </span>nodejs8 <span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">CodeUri</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#39;./&#39;</span><span style="color:#bbb"> 
</span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">Events</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">TimeTrigger</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">Type</span>:<span style="color:#bbb"> </span>Timer <span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#008000;font-weight:bold">Properties</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">CronExpression</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;0 0/1 * * * *&#34;</span><span style="color:#bbb">  
</span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">Enable</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb"> 
</span><span style="color:#bbb">
</span></code></pre></div><p>å¦‚æœæ—¥å¿—åº“å’Œå‡½æ•°æœåŠ¡ä¸åœ¨åŒä¸€ä¸ªåœ°åŸŸï¼Œå‡½æ•°æœåŠ¡å°±ä¼šæ‰¾ä¸åˆ°æ—¥å¿—åº“ï¼Œ<code>fun deploy</code> ä¹Ÿä¼šæŠ¥é”™ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ<code>yunzhi-log-qingdao</code> æ˜¯æˆ‘åˆ›å»ºçš„ä¸€ä¸ªé’å²›åœ°åŸŸçš„æ—¥å¿— Projectã€‚</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fun deploy
using region: cn-shanghai
using accountId: ***********4698
using accessKeyId: ***********UfpF
using timeout: <span style="color:#666">60</span>

Waiting <span style="color:#a2f;font-weight:bold">for</span> service yunzhi to be deployed...
        retry <span style="color:#666">1</span> <span style="color:#a2f">times</span>
        retry <span style="color:#666">2</span> <span style="color:#a2f">times</span>
        retry <span style="color:#666">3</span> <span style="color:#a2f">times</span>
        retry <span style="color:#666">4</span> <span style="color:#a2f">times</span>
        retry <span style="color:#666">5</span> <span style="color:#a2f">times</span>
        retry <span style="color:#666">6</span> <span style="color:#a2f">times</span>
        retry <span style="color:#666">7</span> <span style="color:#a2f">times</span>
PUT /services/yunzhi failed with 400. requestid: 6af2afb8-cbd9-0d3e-bf16-fe623834b4ee, message: project <span style="color:#b44">&#39;yunzhi-log-qingdao&#39;</span> does not exist.
</code></pre></div><h2 id="å…¶ä»–é—®é¢˜">å…¶ä»–é—®é¢˜ <a href="#%e5%85%b6%e4%bb%96%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—</a></h2><h3 id="ä»£ç ç‰ˆæœ¬çš„ç®¡ç†">ä»£ç ç‰ˆæœ¬çš„ç®¡ç† <a href="#%e4%bb%a3%e7%a0%81%e7%89%88%e6%9c%ac%e7%9a%84%e7%ae%a1%e7%90%86" class="anchor">ğŸ”—</a></h3><p>åœ¨å®ç°æŠ¥è­¦åŠŸèƒ½çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¾æ—§ä½¿ç”¨äº† GitLab æ¥å­˜å‚¨ä»£ç ã€‚æ¯æ¬¡å¼€å‘å®Œæˆä¹‹åï¼Œå°†ä»£ç  push åˆ° GitLabï¼Œç„¶åå†å°†ä»£ç éƒ¨ç½²åˆ°å‡½æ•°è®¡ç®—ä¸Šã€‚ä¸è¿‡è¿™ä¸¤ä¸ªè¿‡ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œè¿˜æ˜¯ä¸é‚£ä¹ˆæ–¹ä¾¿ã€‚</p>
<h3 id="ç¯å¢ƒé—®é¢˜">ç¯å¢ƒé—®é¢˜ <a href="#%e7%8e%af%e5%a2%83%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—</a></h3><p>ä¸€èˆ¬æˆ‘ä»¬å¼€å‘çš„æ—¶å€™ï¼Œéœ€è¦æ—¥å¸¸ã€é¢„å‘ã€çº¿ä¸Šå¤šä¸ªç¯å¢ƒéƒ¨ç½²ã€æµ‹è¯•ã€‚é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æ˜¯ä¸€ä¸ªäº‘äº§å“ï¼Œæ²¡æœ‰ç¯å¢ƒçš„åŒºåˆ†ã€‚ä½†å¯¹äºæŠ¥è­¦æ•´ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å»åŒºåˆ†ç¯å¢ƒï¼Œåªæ˜¯æœ¬åœ°å¼€å‘çš„æ—¶å€™ï¼Œå°†æŠ¥è­¦æ¶ˆæ¯å‘åˆ°ä¸€ä¸ªæµ‹è¯•çš„é’‰é’‰ç¾¤ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰ç‰¹åˆ«å»å…³æ³¨ã€‚</p>
<h3 id="ç»æµæˆæœ¬">ç»æµæˆæœ¬ <a href="#%e7%bb%8f%e6%b5%8e%e6%88%90%e6%9c%ac" class="anchor">ğŸ”—</a></h3><p>ä½¿ç”¨å‡½æ•°è®¡ç®—çš„ç»æµæˆæœ¬ï¼Œç›¸æ¯”äºè´­ä¹°äº‘æœåŠ¡å™¨éƒ¨ç½²åº”ç”¨ï¼Œæˆæœ¬ä½äº†éå¸¸å¤šã€‚</p>
<p>æœ¬æ–‡ä¸­æ¶‰åŠåˆ°å‡½æ•°è®¡ç®—å’Œæ—¥å¿—æœåŠ¡ä¸¤ä¸ªäº‘äº§å“ï¼Œéƒ½æœ‰ä¸€å®šçš„å…è´¹é¢åº¦ã€‚å…¶ä¸­å‡½æ•°è®¡ç®—æ¯æœˆå‰ 100 ä¸‡æ¬¡å‡½æ•°è°ƒç”¨å…è´¹ï¼Œæ—¥å¿—æœåŠ¡æ¯æœˆä¹Ÿæœ‰ 500M çš„å…è´¹å­˜å‚¨ç©ºé—´å’Œè¯»å†™æµé‡ã€‚æ‰€ä»¥åªç”¨æ¥æµ‹è¯•æˆ–è€…å®ç°ä¸€äº›è°ƒç”¨é‡å¾ˆå°çš„åŠŸèƒ½ï¼ŒåŸºæœ¬æ˜¯å…è´¹çš„ã€‚</p>
<ul>
<li><a 
    href="https://help.aliyun.com/document_detail/54301"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    å‡½æ•°è®¡ç®—è®¡è´¹æ–¹å¼
</a></li>
<li><a 
    href="https://help.aliyun.com/document_detail/48220.html"
    
    
     
      target="_blank" 
      rel="noopener"
    
>
    æ—¥å¿—æœåŠ¡äº§å“å®šä»·
</a></li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“ <a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—</a></h2><p>é…ç½®äº†å‡½æ•°çš„æ—¥å¿—ä¹‹åï¼Œå°†å‡½æ•°éƒ¨ç½²åˆ°å‡½æ•°è®¡ç®—ä¸Šï¼Œå°±ç®—æ˜¯æ­£å¼å‘å¸ƒä¸Šçº¿äº†ã€‚</p>
<p>ç°åœ¨å›è¿‡å¤´æ¥çœ‹ï¼Œæ•´ä¸ªæµç¨‹è¿˜ç®—æ¯”è¾ƒç®€å•ã€‚ä½†ä»é›¶å¼€å§‹ä¸€æ­¥ä¸€æ­¥åˆ°éƒ¨ç½²ä¸Šçº¿çš„è¿‡ç¨‹ï¼Œè¿˜æ˜¯é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚æ–‡ä¸­çš„è®¸å¤šæ³¨æ„äº‹é¡¹ï¼Œéƒ½æ˜¯åœ¨ä¸æ–­å°è¯•ä¸­å¾—å‡ºçš„ç»“è®ºã€‚</p>
<p>æœ€è¿‘ serverless è¿™ä¸ªè¯é¢˜ä¹Ÿå¾ˆç«çƒ­ï¼Œä¹ŸæœŸå¾…è¿™ä¸ªæŠ€æœ¯å³å°†å¸¦æ¥çš„å˜é©ã€‚</p>

    </div>

    
        <div class="tags">
            
                <a href="https://nodejh.com/tags/serverless">Serverless</a>
            
        </div>
    
    
    <div id="comment">
  
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "nodejh" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/nodejh" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://stackoverflow.com/users/4518882/nodejh" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>stackoverflow</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-488.000000, -1163.000000)">
            <g id="stackoverflow" transform="translate(488.000000, 1163.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M42.0860128,53.5922927 L22.9745951,53.6011499 L22.9729497,49.5538824 L42.0835447,49.5440929 L42.0860128,53.5922927 L42.0860128,53.5922927 Z M55,30.6708298 L51.7306912,12 L47.7087256,12.6920259 L50.9775643,31.3628557 L55,30.6708298 L55,30.6708298 Z M42.5455518,44.3547147 L23.5156994,42.616026 L23.1410164,46.6470941 L42.1712214,48.3841513 L42.5455518,44.3547147 L42.5455518,44.3547147 Z M43.8009984,39.0731519 L25.3459811,34.1539179 L24.285633,38.0621508 L42.7419431,42.9819676 L43.8009984,39.0731519 L43.8009984,39.0731519 Z M46.2103463,34.4436411 L29.7494464,24.8164635 L27.6748215,28.3015328 L44.1365441,37.9292931 L46.2103463,34.4436411 L46.2103463,34.4436411 Z M50.2466504,31.6088756 L46.8745036,33.8883189 L36.106599,18.2318456 L39.4792159,15.9517031 L50.2466504,31.6088756 Z M45.3315807,40.2784283 L48.5799693,40.2784283 L48.5799693,60 L17,60 L17,40.2784283 L20.2648427,40.2784283 L20.2648427,56.8243495 L45.3315807,56.8243495 L45.3315807,40.2784283 Z" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://twitter.com/nodejh" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <p class="copyright">
    
       Â© Copyright 
       2021 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Hang Jiang
    
    </p>
    <p class="powerby">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/nodejh/hugo-theme-cactus-plus">nodejh</a>
    </p>
</footer>

  </body>
</html>
